

[å¤šçº¿ç¨‹01ï¼šæ¦‚è¿°_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1V4411p7EF?p=1&vd_source=796ed40051b301bfa3a84ba357f4828c)çš„è‡ªå­¦ç¬”è®°

>1. [å¤šçº¿ç¨‹](##ä¸€. å¤šçº¿ç¨‹)
>2. [Lambdaè¡¨è¾¾å¼](##äºŒ. Lambdaè¡¨è¾¾å¼)
>3. [é™æ€ä»£ç†æ¨¡å¼](##ä¸‰.  é™æ€ä»£ç†æ¨¡å¼)
>
>

## ä¸€. å¤šçº¿ç¨‹

å¤šçº¿ç¨‹æ˜¯[é™æ€ä»£ç†](##ä¸‰. é™æ€ä»£ç†æ¨¡å¼)æ¨¡å¼

- çº¿ç¨‹å°±æ˜¯ç‹¬ç«‹çš„æ‰§è¡Œè·¯å¾„

- åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå³ä½¿æ²¡æœ‰è‡ªå·±åˆ›å»ºçº¿ç¨‹ï¼Œåå°ä¹Ÿä¼šæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¦‚ä¸»çº¿ç¨‹ï¼Œgcçº¿ç¨‹

- main()ç§°ä¹‹ä¸ºä¸»çº¿ç¨‹ï¼Œä¸ºç³»ç»Ÿçš„å…¥å£ï¼Œç”¨äºæ‰§è¡Œæ•´ä¸ªç¨‹åº

- åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå¦‚æœå¼€è¾Ÿäº†å¤šä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹çš„è¿è¡Œç”±**è°ƒåº¦å™¨(cpu)å®‰æ’è°ƒåº¦**ï¼Œè°ƒåº¦å™¨æ˜¯ä¸æ“ä½œç³»ç»Ÿç´§å¯†ç›¸å…³çš„ï¼Œå…ˆåé¡ºåºæ˜¯ä¸èƒ½äººä¸ºçš„å¹²é¢„çš„

- å¯¹åŒä¸€ä»½èµ„æºæ“ä½œæ—¶ï¼Œä¼šå­˜åœ¨èµ„æºæŠ¢å¤ºçš„é—®é¢˜ï¼Œéœ€è¦åŠ å…¥**å¹¶å‘æ§åˆ¶**

- çº¿ç¨‹ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ï¼Œå¦‚cpuè°ƒåº¦æ—¶é—´ï¼Œå¹¶å‘æ§åˆ¶å¼€é”€

- æ¯ä¸ªçº¿ç¨‹åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜äº¤äº’ï¼Œå†…å­˜æ§åˆ¶ä¸å½“ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´

  > å½“å‘ç”Ÿå¹¶å‘æ—¶ï¼Œå¦‚ä¹°ç¥¨ï¼Œå¤šä¸ªäººåŒæ—¶ä¹°ï¼Œä»–ä»¬éƒ½å‘ç°å”®ç¥¨å¤„è¿˜æœ‰ä¸€å¼ ç¥¨ï¼Œå°±æŠŠä¸€å¼ ç¥¨æ‹·è´çš„è‡ªå·±çš„å†…å­˜åŒºåŸŸï¼Œç„¶åè¿›è¡Œè´­ä¹°ï¼Œç»“æœæ˜¯æ¯äººä¹°äº†ä¸€å¼ ç¥¨ï¼Œè´­ä¹°æ—¶å”®ç¥¨å¤„ç¥¨æ•°`--`ï¼Œå”®ç¥¨å¤„è¿˜æœ‰è´Ÿæ•°å¼ ç¥¨ï¼‰

### 1. çº¿ç¨‹çš„ä¸‰ç§å®ç°æ–¹å¼

> 1. [ç»§æ‰¿Threadç±»(é‡ç‚¹)](####1.1 ç»§æ‰¿Threadç±»(é‡ç‚¹))
>    - ä¸å»ºè®®ä½¿ç”¨ï¼ŒOOPå•ç»§æ‰¿å±€é™æ€§
>      - å•ç»§æ‰¿ï¼šjavaåªèƒ½ç»§æ‰¿ä¸€ä¸ªï¼Œä¸èƒ½ç»§æ‰¿å¤šä¸ªï¼Œåªèƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»
> 2. [å®ç°Runnableæ¥å£(é‡ç‚¹)](####1.2 å®ç°Runnableæ¥å£(é‡ç‚¹))
>    - æ¨èä½¿ç”¨ï¼Œé¿å…å•ç»§æ‰¿å±€é™æ€§ï¼Œçµæ´»æ–¹ä¾¿ï¼Œæ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨
> 3. [å®ç°Callableæ¥å£(äº†è§£)](####1.3 å®ç°Callableæ¥å£(äº†è§£))

æ³¨ï¼š

>1å’Œ2ä¸¤ç§æ–¹å¼æœ¬è´¨æ—¶ä¸€æ ·çš„ï¼š
>
>1. æºç ä¸­Threadç±»å®ç°äº†Runnableæ¥å£
>   - ç»§æ‰¿Threadç±»ä¾¿ç­‰åŒäºå®ç°äº†Runnableæ¥å£ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ç±»äº†
>2. Threadç±»ä¸­æœ‰start()sleep()ç­‰æ–¹æ³•
>   - ç»§æ‰¿Threadç±»å°±æœ‰äº†start()ç­‰æ–¹æ³•
>   - å®ç°Runnableæ¥å£è¿™ä¸ªæ–¹å¼æ²¡æœ‰è¿™äº›æ–¹æ³•ï¼Œéœ€è¦ç”¨Threadä»£ç†ä½¿ç”¨è¿™äº›æ–¹æ³•
>     - Threadä»£ç†å°±æ˜¯ç”¨Threadå¸¦å‚æ„é€ æ–¹æ³•å°†Runnableæ¥å£å®ç°ç±»å¯¹è±¡ä½œä¸ºå‚æ•°åˆ›å»ºThreadå¯¹è±¡ï¼Œè°ƒç”¨start()ç­‰æ–¹æ³•

#### 1.1 ç»§æ‰¿Threadç±»(é‡ç‚¹)

1. è‡ªå®šä¹‰çº¿ç¨‹ç±»ç»§æ‰¿`extends Thread`

   ```java
   public class TestThread1 extends Thread{}
   ```

2. é‡å†™`run()`æ–¹æ³•ï¼Œç¼–å†™çº¿ç¨‹æ‰§è¡Œä½“
   ```java
   @Override
       public void run(){}
   ```
   
3. *åˆ›å»ºè‡ªå®šä¹‰çº¿ç¨‹ç±»å¯¹è±¡ï¼Œè°ƒç”¨start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹*(ä¸å®ç°[Runnableæ¥å£](###2. å®ç°Runnableæ¥å£)æœ‰åŒºåˆ«)
   
   ```java
   TestThread1 testThread1 = new TestThread1();
   testThread1.start();
   ```

##### 1.1.1 æ¼”ç¤º

```java
// åˆ›å»ºçº¿ç¨‹æ–¹å¼1ï¼šç»§æ‰¿Threadç±»
public class TestThread1 extends Thread{
    @Override
    public void run() {
        //runæ–¹æ³•çº¿ç¨‹ä½“
        for (int i = 0; i < 2000; i++) {
            System.out.println("æˆ‘åœ¨çœ‹ä»£ç --" + i);
        }
    }

    public static void main(String[] args) {
        //mainçº¿ç¨‹ï¼Œä¸»çº¿ç¨‹
        //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡
        TestThread1 testThread1 = new TestThread1();
        //è°ƒç”¨start()æ–¹æ³•å¼€å¯çº¿ç¨‹
        testThread1.start();//çº¿ç¨‹ä¸ä¸€å®šç«‹å³æ‰§è¡ŒCPUå®‰æ’è°ƒåº¦

        for (int i = 0; i < 2000; i++) {
            System.out.println("æˆ‘åœ¨å­¦ä¹ å¤šçº¿ç¨‹--" + i);
        }
    }
}
```

##### 1.1.2 æ¡ˆä¾‹ 

###### 1.1.2.1 Threadå®ç°å¤šçº¿ç¨‹åŒæ­¥ä¸‹è½½å›¾ç‰‡

> é¦–å…ˆéœ€è¦jaråŒ…([Commons IO â€“ Download Apache Commons IO](https://commons.apache.org/proper/commons-io/download_io.cgi))ç”¨äºä¸‹è½½ç½‘ç»œå›¾ç‰‡

```java
import org.apache.commons.io.FileUtils;

import java.io.File;
import java.io.IOException;
import java.net.URL;
// ç»ƒä¹ 
//  Threadå®ç°å¤šçº¿ç¨‹åŒæ­¥ä¸‹è½½å›¾ç‰‡
//  é¦–å…ˆéœ€è¦å¼•å…¥jaråŒ…
public class TestThread2 extends Thread{
    private String url;//ç½‘ç»œå›¾ç‰‡åœ°å€
    private String name;//ä¿å­˜çš„æ–‡ä»¶å

    public TestThread2(String url, String name) {
        this.url = url;
        this.name = name;
    }
    @Override
    public void run() {
        WebDownloader webDownloader = new WebDownloader();
        webDownloader.downloader(url, name);
        System.out.println("ç°åœ¨çš„æ–‡ä»¶åä¸ºï¼š" + name);
    }

    public static void main(String[] args) {
        TestThread2 t1 = new TestThread2("https://img-home.csdnimg.cn/images/20230213094345.jpg", "1.jpg");
        TestThread2 t2 = new TestThread2("https://img-home.csdnimg.cn/images/20230213094345.jpg", "2.jpg");
        TestThread2 t3 = new TestThread2("https://img-home.csdnimg.cn/images/20230213094345.jpg", "3.jpg");
        t1.start();
        t2.start();
        t3.start();
    }
}

class WebDownloader {
    //ä¸‹è½½æ–¹æ³•
    public void downloader(String url, String name) {
        try {
            FileUtils.copyURLToFile(new URL(url), new File(name));//æŠŠä¸€ä¸ªç½‘ç»œurlå˜ä¸ºå›¾ç‰‡ä¸‹è½½ä¸ºname
        } catch (IOException e) {
            e.printStackTrace();
            System.out.println("IOå¼‚å¸¸,downloadæ–¹æ³•å‡ºç°é—®é¢˜");
        }
    }
}
```

#### 1.2 å®ç°Runnableæ¥å£(é‡ç‚¹)

1. å®šä¹‰ç±»ï¼Œå®ç°Runnableæ¥å£
   ```java
   public class TestThread3 implements Runnable{}
   ```
   
2. å®ç°run()æ–¹æ³•ï¼Œç¼–å†™çº¿ç¨‹æ‰§è¡Œä½“
   ```java
   @Override
       public void run() {}
   ```
   
3. åˆ›å»ºRunnableæ¥å£çš„å®ç°ç±»å¯¹è±¡
   ```java
   TestThread3 testThread3 = new TestThread3();
   ```
   
4. *åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œè°ƒç”¨çº¿ç¨‹å¯¹è±¡è°ƒç”¨start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹*, <u>ä»£ç†</u>   (ä¸[ç»§æ‰¿Threadç±»](###1. ç»§æ‰¿Threadç±»)æœ‰åŒºåˆ«)

   ```java
   Thread thread = new Thread(testThread3);//ä»£ç†
   thread.start();
   ```
   
   

##### 1.2.1 æ¼”ç¤º

```java
public class TestThread3 implements Runnable{
    @Override
    public void run() {
        //runæ–¹æ³•çº¿ç¨‹ä½“
        for (int i = 0; i < 2000; i++) {
            System.out.println("æˆ‘åœ¨çœ‹ä»£ç --" + i);
        }
    }

    public static void main(String[] args) {
        //mainçº¿ç¨‹ï¼Œä¸»çº¿ç¨‹
        //åˆ›å»ºä¸€ä¸ªRunnableæ¥å£çš„å®ç°ç±»(ä¸€ä»½èµ„æº)
        TestThread3 testThread3 = new TestThread3();
        
/*
        //åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œé€šè¿‡çº¿ç¨‹å¯¹è±¡æ¥å¼€å¯çº¿ç¨‹ï¼Œ(å¤šæ¬¡ä»£ç†)
        Thread thread1 = new Thread(testThread3);//å‚æ•°: runnableæ¥å£çš„å®ç°ç±»
        Thread thread2 = new Thread(testThread3);
        //è°ƒç”¨start()æ–¹æ³•å¼€å¯çº¿ç¨‹
        thread.start();
        thread.start();
*/
        
        //åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œé€šè¿‡çº¿ç¨‹å¯¹è±¡æ¥å¼€å¯çº¿ç¨‹ï¼Œ(å¤šæ¬¡ä»£ç†)
        new Thread(testThread3).start();//åŒä¸Šä¸¤è¡Œä»£ç 
        new Thread(testThread3).start();

        for (int i = 0; i < 2000; i++) {
            System.out.println("æˆ‘åœ¨å­¦ä¹ å¤šçº¿ç¨‹--" + i);
        }
    }
}
```

##### 1.2.2 æ¡ˆä¾‹(å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€åŒä¸ªå¯¹è±¡)

###### 1.2.2.1 ä¹°ç«è½¦ç¥¨

```java
//å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå¯¹è±¡
//ä¹°ç«è½¦ç¥¨

//å‘ç°é—®é¢˜ å¤šä¸ªèµ„æºæ“ä½œåŒä¸€ä¸ªèµ„æºçš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•°æ®ç´Šä¹±
//	æœ‰æ—¶æŠ¢åˆ°åŒä¸€å¼ ç¥¨ï¼Œåˆæœ‰æ—¶æŠ¢åˆ°0æˆ–-1å¼ ç¥¨
public class TestThread4 implements Runnable{

    //ç¥¨æ•°
    int tickNumbers = 10;

    @Override
    public void run() {
        while (true) {
            if (tickNumbers <= 0) {
                break;
            }
            //æ¨¡æ‹Ÿå»¶æ—¶
            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            System.out.println(Thread.currentThread().getName() + "æ‹¿åˆ°äº†ç¬¬" + tickNumbers-- + "å¼ ç¥¨");
        }
    }

    public static void main(String[] args) {
        TestThread4 ticket = new TestThread4();

        new Thread(ticket, "å°æ˜").start();
        new Thread(ticket, "è€å¸ˆ").start();
        new Thread(ticket, "é»„ç‰›å…š").start();
    }
}
```

###### 2.2.2 é¾Ÿå…”èµ›è·‘

```java
//æ¨¡æ‹Ÿé¾Ÿå…”èµ›è·‘
public class Race implements Runnable {
    //èƒœåˆ©è€…
    private static String winner;

    @Override
    public void run() {
        for (int i = 0; i <= 1000; i++) {

            //æ¨¡æ‹Ÿå…”å­ä¼‘æ¯ ä¸”æ¯50æ­¥ä¼‘æ¯ä¸€æ¬¡
            if (Thread.currentThread().getName().equals("å…”å­") && i%50 == 0) {
                try {
                    Thread.sleep(10);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            //åˆ¤æ–­æ¯”èµ›æ˜¯å¦ç»“æŸ
            boolean flag = gameOver(i);
            if (flag) {
                break;
            }
            System.out.println(Thread.currentThread().getName() + "è·‘äº†" + i + "æ­¥");
        }
    }


    /**
     * åˆ¤æ–­æ¯”èµ›æ˜¯å¦ç»“æŸ
     * @param steps æ­¥æ•°
     * @return
     */
    private boolean gameOver(int steps) {
        if (winner != null) {
            //å·²ç»å­˜åœ¨èƒœåˆ©è€…äº†
            return true;
        }
        {   //è¿™æ˜¯ä¸€ä¸ªä»£ç å—
            if (steps >= 1000) {
                winner = Thread.currentThread().getName();
                System.out.println("winner is " + winner);
                return true;
            }
        }
        return false;
    }

    public static void main(String[] args) {
        Race race = new Race();//ä¸€æ¡èµ›é“

        new Thread(race, "å…”å­").start();
        new Thread(race, "ä¹Œé¾Ÿ").start();
    }
}
```

#### 1.3 å®ç°Callableæ¥å£(äº†è§£)

1. å®ç°Callableæ¥å£ï¼Œéœ€è¦è¿”å›å€¼ç±»å‹
   ```java 
   implements Callable<è¿”å›å€¼ç±»å‹> 
   ```

2. `é‡å†™callæ–¹æ³•ï¼Œéœ€è¦æŠ›å‡ºå¼‚å¸¸

   ```java
   @Override
   public è¿”å›å€¼ç±»å‹ call() {}
   ```

3. åˆ›å»ºç›®æ ‡å¯¹è±¡(Callableæ¥å£å®ç°ç±»)

   ```java
   ç›®æ ‡ç±» ç›®æ ‡å¯¹è±¡ = new ç›®æ ‡ç±»();
   ```

4. åˆ›å»ºæ‰§è¡ŒæœåŠ¡(çº¿ç¨‹æ± æœåŠ¡ä¸ºå›ºå®šå‡ ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ) Executor: çº¿ç¨‹æ±  fixedï¼šå›ºå®šçš„ Poolï¼šæ± 
   ```java
   ExecutorService ser = Executors.newFixedThreadPool(çº¿ç¨‹ä¸ªæ•°);
   ```

5. æäº¤æ‰§è¡Œ(è¿”å›ä¸€ä¸ªå°è£…è¿”å›å€¼çš„Futureç±»)
   ```java
   Future<è¿”å›å€¼ç±»å‹> result1 = ser.submit(ç›®æ ‡å¯¹è±¡);
   Future<è¿”å›å€¼ç±»å‹> result2 = ser.submit(ç›®æ ‡å¯¹è±¡);
   //...  è¿™é‡Œå¯ä»¥å†™çº¿ç¨‹ä¸ªæ•°ä¸ªæ‰§è¡Œ
   ```

6. è·å–ç»“æœ
   ```java
   è¿”å›å€¼ç±»å‹ r1 = result1.get();
   è¿”å›å€¼ç±»å‹ r2 = result1.get();
   //...
   ```

7. å…³é—­æœåŠ¡
   ```java
   ser.shutdownNow();
   ```

å¥½å¤„

>Callableçš„å¥½å¤„
>
>1. å¯ä»¥å®šä¹‰è¿”å›å€¼
>2. å¯ä»¥æŠ›å‡ºå¼‚å¸¸

##### 1.3.1 æ¼”ç¤º

```java
public class TestCallable implements Callable<Boolean> {//Booleanæ˜¯è¿”å›å€¼ç±»å‹
    @Override
    public Boolean call() {//è¿™é‡Œçš„call()æ–¹æ³•ç±»ä¼¼ä¸Šä¸¤ç§æ–¹å¼çš„run()æ–¹æ³•
        //calæ–¹æ³•çº¿ç¨‹ä½“
        for (int i = 0; i < 2000; i++) {
            System.out.println("æˆ‘åœ¨çœ‹ä»£ç --" + i);
        }
        return true;
    }
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        TestCallable t1 = new TestCallable();//åˆ›å»ºCallableæ¥å£å®ç°ç±»
        TestCallable t2 = new TestCallable();
        TestCallable t3 = new TestCallable();
        
        //åˆ›å»ºæ‰§è¡ŒæœåŠ¡(çº¿ç¨‹æ± æœåŠ¡ åˆ›å»ºå›ºå®šçº¿ç¨‹æ± ) Executor: çº¿ç¨‹æ±  fixedï¼šå›ºå®šçš„ Poolï¼šæ± 
        ExecutorService ser = Executors.newFixedThreadPool(3);//3æ˜¯å›ºå®šçº¿ç¨‹æ± çš„ä¸ªæ•°
        
        //æäº¤æ‰§è¡Œ (è¿”å›ä¸€ä¸ªå°è£…è¿”å›å€¼ç±»å‹çš„Futureç±»)
        Future<Boolean> r1 = ser.submit(t1);
        Future<Boolean> r2 = ser.submit(t2);
        Future<Boolean> r3 = ser.submit(t3);
        
        //è·å–ç»“æœ
        boolean rs1 = r1.get();
        boolean rs2 = r2.get();
        boolean rs3 = r3.get();

        System.out.println(rs1);
        System.out.println(rs2);
        System.out.println(rs3);
        //å…³é—­çº¿ç¨‹æ± æœåŠ¡
        ser.shutdownNow();
    }
}
```

##### 1.3.2 æ¡ˆä¾‹

###### 1.3.2.1 åˆ©ç”¨Callableæ”¹é€ ä¸‹è½½å›¾ç‰‡æ¡ˆä¾‹

[ç‚¹å‡»æŸ¥çœ‹åŸä¸‹è½½å›¾ç‰‡æ¡ˆä¾‹](#####1.1.2.1 Threadå®ç°å¤šçº¿ç¨‹åŒæ­¥ä¸‹è½½å›¾ç‰‡)

```java
public class TestCallable implements Callable<Boolean> {
    private String url;//ç½‘ç»œå›¾ç‰‡åœ°å€
    private String name;//ä¿å­˜çš„æ–‡ä»¶å

    public TestCallable(String url, String name) {
        this.url = url;
        this.name = name;
    }
    @Override
    public Boolean call() {
        WebDownloader webDownloader = new WebDownloader();
        webDownloader.downloader(url, name);
        System.out.println("ç°åœ¨çš„æ–‡ä»¶åä¸ºï¼š" + name);
        return true;
    }

    public static void main(String[] args) throws ExecutionException, InterruptedException {
        TestCallable t1 = new TestCallable("https://img-home.csdnimg.cn/images/20230213094345.jpg", "1.jpg");
        TestCallable t2 = new TestCallable("https://img-home.csdnimg.cn/images/20230213094345.jpg", "2.jpg");
        TestCallable t3 = new TestCallable("https://img-home.csdnimg.cn/images/20230213094345.jpg", "3.jpg");

        //åˆ›å»ºæ‰§è¡ŒæœåŠ¡ Executor: çº¿ç¨‹æ±  fixedï¼šå›ºå®šçš„ Poolï¼šæ± 
        ExecutorService ser = Executors.newFixedThreadPool(3);

        //æäº¤æ‰§è¡Œ
        Future<Boolean> r1 = ser.submit(t1);
        Future<Boolean> r2 = ser.submit(t2);
        Future<Boolean> r3 = ser.submit(t3);

        //è·å–ç»“æœ
        boolean rs1 = r1.get();
        boolean rs2 = r2.get();
        boolean rs3 = r3.get();

        System.out.println(rs1);
        System.out.println(rs2);
        System.out.println(rs3);
        //å…³é—­æœåŠ¡
        ser.shutdownNow();
    }
}

class WebDownloader {
    //ä¸‹è½½æ–¹æ³•
    public void downloader(String url, String name) {
        try {
            FileUtils.copyURLToFile(new URL(url), new File(name));//æŠŠä¸€ä¸ªç½‘ç»œurlå˜ä¸ºå›¾ç‰‡ä¸‹è½½ä¸ºname
        } catch (IOException e) {
            e.printStackTrace();
            System.out.println("IOå¼‚å¸¸,downloadæ–¹æ³•å‡ºç°é—®é¢˜");
        }
    }
```

### 2. çº¿ç¨‹çš„äº”å¤§çŠ¶æ€æµç¨‹åŠæ–¹æ³•

#### 2.1 äº”å¤§çŠ¶æ€æµç¨‹å›¾

```mermaid
graph TB
%% åˆ›å»ºçŠ¶æ€ï¼šnew Thread();
%% å¯åŠ¨çŠ¶æ€ï¼šthread.start();
%% è¿è¡ŒçŠ¶æ€ï¼šå¯åŠ¨ä¹‹åCPUè°ƒåº¦å®Œäº†
aa["new Thread"]-->a[åˆ›å»ºçŠ¶æ€]--"å¯åŠ¨çº¿ç¨‹(start)"-->b[å°±ç»ªçŠ¶æ€];
b--è·å¾—CPUèµ„æº-->c[è¿è¡ŒçŠ¶æ€]
c--"dead()"-->d[æ­»äº¡çŠ¶æ€]
c--"sleep()ã€wait()ã€åŒæ­¥é”å®šç­‰"-->e[é˜»å¡çŠ¶æ€]
c--"yield()çº¿ç¨‹ç¤¼è®©"-->b
e--é˜»å¡è§£é™¤-->b
```

#### 2.2 çº¿ç¨‹æ–¹æ³•

| æ–¹æ³•                           | è¯´æ˜                                                         |
| ------------------------------ | ------------------------------------------------------------ |
| setPriority(int newPriority)   | æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§                                             |
| static void sleep(long millis) | è®©å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ä¼‘çœ millisæ¯«ç§’                           |
| void join()                    | ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢                                               |
| static void yield()            | çº¿ç¨‹ç¤¼è®©ï¼Œä»è¿è¡ŒçŠ¶æ€è½¬ä¸ºå°±ç»ªçŠ¶æ€ï¼Œé‡æ–°å¼€å§‹cpuè°ƒåº¦ï¼Œä»è¿è¡ŒçŠ¶æ€è½¬ä¸ºå°±ç»ªçŠ¶æ€ |
| void interrupt()               | ä¸­æ–­çº¿ç¨‹(ä¸å»ºè®®ç”¨è¿™ç§æ–¹å¼)                                   |
| boolean isAlive()              | æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€                                     |

#### 2.3ã€stopã€‘åœæ­¢

- è¿™é‡Œçš„stopæ˜¯è‡ªå·±å†™çš„ï¼Œéœ€è¦è‡ªå·±æ§åˆ¶

##### 2.3.1 è¯¦è§£

- ä¸æ¨èä½¿ç”¨JDKæä¾›çš„stop()ã€destriyæ–¹æ³•ã€å·²åºŸå¼ƒã€‘

- æ¨èçº¿ç¨‹è‡ªå·±åœä¸‹æ¥

  - å»ºè®®ä½¿ç”¨ä¸€ä¸ªæ ‡å¿—ä½è¿›è¡Œç»ˆæ­¢å˜é‡ï¼Œå½“flag=falseï¼Œåˆ™ç»ˆæ­¢çº¿ç¨‹
    
    ```java
    public class Thread1 implements Runnable{	
    	@Override
    	public void run() {
    	    //çº¿ç¨‹ä½“ä½¿ç”¨è¯¥æ ‡å¿—
    	    while (flag) {
    	        //...
    	    }
    	}
    	//åœ¨çº¿ç¨‹ä¸­å†™ä¸€ä¸ªstopæ–¹æ³•ï¼Œç”¨äºä¿®æ”¹æ ‡å¿—ä½
    	public void stop() {
    	    this.flag = false;
    	}
    }
    ```
    

##### 2.3.2 ä»£ç æ¼”ç¤º

```java
public class TestStop implements Runnable{

//    1.è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½
    private boolean flag = true;
    @Override
    public void run() {
        int i = 0;//çº¿ç¨‹æ‰§è¡Œçš„æ¬¡æ•°
        while (flag) {
            System.out.println("çº¿ç¨‹æ‰§è¡Œrun...Thread" + i++ + "æ¬¡");
        }
    }

//    2.è®¾ç½®ä¸€ä¸ªå…¬å¼€çš„æ–¹æ³•åœæ­¢çº¿ç¨‹ï¼Œè½¬æ¢æ ‡å¿—ä½
    public  void stop() {
        this.flag = false;
    }

    public static void main(String[] args) {
        TestStop testStop = new TestStop();
        new Thread(testStop).start();
        System.out.println("çº¿ç¨‹å¼€å§‹äº†");

        for (int i = 0; i < 2000; i++) {//i mainæ–¹æ³•æ‰§è¡Œçš„æ¬¡æ•°
            System.out.println("mainæ‰§è¡Œ" + i + "æ¬¡");
            if (i == 900) {
//                è°ƒç”¨stopæ–¹æ³•åˆ‡æ¢æ ‡å¿—ä½ï¼Œè®©çº¿ç¨‹åœæ­¢
                testStop.stop();
                System.out.println("çº¿ç¨‹åœæ­¢äº†");
            }
        }
    }
}
```

#### 2.4 sleepä¼‘çœ 

##### 2.4.1 è¯¦è§£

- sleep(æ¯«ç§’å€¼)ï¼šæŒ‡å®šå½“å‰çº¿ç¨‹é˜»å¡çš„æ¯«ç§’å€¼
- sleepå­˜åœ¨InterruptedException
- sleepæ—¶é—´è¾¾åˆ°åçº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€
- sleepå¯ä»¥æ¨¡æ‹Ÿç½‘ç»œå»¶æ—¶ï¼Œå€’è®¡æ—¶ç­‰
- æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªé”ğŸ”’ï¼Œsleepä¸ä¼šé‡Šæ”¾é”

##### 2.4.2 ä»£ç æ¼”ç¤º

```java
////æ‰“å°10æ¬¡å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œæ¯ç§’æ‰“å°ä¸€æ¬¡
public static void main(String[] args) {
        Date startTime = new Date(System.currentTimeMillis());//è·å–ç³»ç»Ÿå½“å‰æ—¶é—´
        int i = 0;
        while (i < 10) {
            try {
                Thread.sleep(1000);
                System.out.println(new SimpleDateFormat("HH:mm:ss").format(startTime));
                startTime = new Date(System.currentTimeMillis());
                i++;
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }
}
```

#### 2.5 yieldç¤¼è®©

- ç¤¼è®©å°±æ˜¯é‡æ–°å¼€å§‹cpuè°ƒåº¦ï¼Œä»è¿è¡ŒçŠ¶æ€è½¬ä¸ºå°±ç»ªçŠ¶æ€

##### 2.5.1 è¯¦è§£

- å°†çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€è½¬ä¸ºå°±ç»ªçŠ¶æ€ï¼Œä½†ä¸é˜»å¡ï¼Œä¸å…¶ä»–çº¿ç¨‹é‡æ–°ç«äº‰cpu
- è®©cpué‡æ–°è°ƒåº¦ï¼Œç¤¼è®©ä¸ä¸€å®šä¼šæ¯”å…¶ä»–çº¿ç¨‹æ…¢ï¼Œçœ‹cpuå¿ƒæƒ…

##### 2.5.2 ä»£ç æ¼”ç¤º

```java
public class TestYield {
    public static void main(String[] args) {
        MyYield myYield = new MyYield();

        new Thread(myYield, "a").start();
        new Thread(myYield, "b").start();
    }
}

class MyYield implements Runnable {
    @Override
    public void run() {
        System.out.println(Thread.currentThread().getName() + "çº¿ç¨‹å¼€å§‹æ‰§è¡Œ");
        //ç¤¼è®©åï¼Œç”²ä»è¿è¡ŒçŠ¶æ€è½¬ä¸ºæš‚åœ(å°±ç»ªçŠ¶æ€)ï¼Œä¹™æœ¬å°±æ˜¯å°±ç»ªçŠ¶æ€ï¼Œcpué‡æ–°è°ƒåº¦ï¼Œå¯èƒ½å‡ºç°ç”²ç»§ç»­è¿è¡Œ
        Thread.yield();
        System.out.println(Thread.currentThread().getName() + "çº¿ç¨‹åœæ­¢æ‰§è¡Œ");
    }
}
```

#### 2.6 joinæ’é˜Ÿ

##### 2.6.1 è¯¦è§£

- å¼ºåˆ¶æ‰§è¡Œä¸”å¾ˆéœ¸é“
- ç±»ä¼¼vipï¼Œæ²¡æœ‰æ’é˜Ÿ(æ²¡æœ‰vip)æ—¶å…¬å¹³æ‰§è¡Œï¼Œæ’é˜Ÿ(æœ‰vip)åå¼ºåˆ¶æ‰§è¡Œæ’é˜Ÿçº¿ç¨‹
- ç›´åˆ°æ’é˜Ÿ(vip)çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ‰å¯æ‰§è¡Œå…¶ä»–çº¿ç¨‹

##### 2.6.2 ä»£ç æ¼”ç¤º

```java
//æ’é˜Ÿ,ä¸”å¾ˆéœ¸é“
public class TestJoin implements Runnable{
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            System.out.println("çº¿ç¨‹vipæ¥å•¦" + i);
        }
    }

    public static void main(String[] args) throws InterruptedException {
        //å¯åŠ¨æˆ‘ä»¬çš„çº¿ç¨‹
        TestJoin testJoin = new TestJoin();
        Thread thread = new Thread(testJoin);
        thread.start();

        //ä¸»çº¿ç¨‹
        for (int i = 0; i < 1000; i++) {
            if (i == 200) {
                thread.join();//æ’mainçº¿ç¨‹çš„é˜Ÿï¼Œå½“mainçº¿ç¨‹æ‰§è¡Œåˆ°199æ—¶threadæ‰§è¡Œä¸”å¿…é¡»threadæ‰§è¡Œå®Œåmainæ‰èƒ½ç»§ç»­æ‰§è¡Œ
            }
            System.out.println("main" + i);
        }
    }
}
```

#### 2.7 è§‚æµ‹çº¿ç¨‹çŠ¶æ€

##### 2.7.1 è¯­æ³•

stateæ˜¯Threadä¸­ä¸€ä¸ªæšä¸¾ç±»å‹çš„å˜é‡

```java
Thread.State state = thread.getState();
```

##### 2.7.2 å«ä¹‰

| çŠ¶æ€          | ç®€è¿° | å«ä¹‰                                                   |
| ------------- | ---- | ------------------------------------------------------ |
| NEW           | æ–°ç”Ÿ | å°šæœªå¯åŠ¨çš„çº¿ç¨‹                                         |
| RUNNABLE      | è¿è¡Œ | Javaè™šæ‹Ÿæœºä¸­æ‰§è¡Œçš„çº¿ç¨‹                                 |
| BLOCKED       | é˜»å¡ | è¢«é˜»å¡ç­‰å¾…ç›‘è§†å™¨é”å®šçš„çº¿ç¨‹                             |
| WAITING       | é˜»å¡ | æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šåŠ¨ä½œçš„çº¿ç¨‹                   |
| TIMED WAITING | é˜»å¡ | æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŠ¨ä½œè¾¾åˆ°æŒ‡å®šæ—¶é—´çš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ |
| TERMINATED    | æ­»äº¡ | å·²é€€å‡ºçš„çº¿ç¨‹                                           |

### 3.  çº¿ç¨‹ä¼˜å…ˆçº§

#### 3.1 è¯¦æƒ…

çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”¨æ•°å­—è¡¨ç¤ºï¼ŒèŒƒå›´ä»0~10(æ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œcpuè¶Šå®¹æ˜“è°ƒåº¦)

```java
//Threadä¸­æºç çš„ä¸€äº›å¸¸é‡
public static final int MAX_PRIORITY = 10;
...
```

> Thread.MIN_PRIORITY = 1
> Thread.MAX_PRIORITY = 10
> Thread.NORE_PRIORITY = 5

ä½¿ç”¨`getPriority()`å’Œ`setPriority(int xxx)`æ¥è·å–å’Œæ”¹å˜ä¼˜å…ˆçº§

#### 3.2 ä»£ç æ¼”ç¤º

```java
//æ‰“å°ä¸åŒä¼˜å…ˆçº§çš„å„çº¿ç¨‹ï¼Œè§‚å¯Ÿæ‰§è¡Œé¡ºåº
public class TestPriority{
    public static void main(String[] args) {
        //mainä¸»çº¿ç¨‹æ˜¯é»˜è®¤ä¼˜å…ˆçº§5ï¼Œæ— æ³•æ”¹å˜
        System.out.println(Thread.currentThread().getName() + "-->" + Thread.currentThread().getPriority());

        MyPriority myPriority = new MyPriority();
        Thread t1 = new Thread(myPriority);
        Thread t2 = new Thread(myPriority);
        Thread t3 = new Thread(myPriority);
        Thread t4 = new Thread(myPriority);
        Thread t5 = new Thread(myPriority);
        Thread t6 = new Thread(myPriority);

        //è®¾ç½®ä¼˜å…ˆçº§ï¼ˆä¼˜å…ˆçº§å†1-10ä¹‹é—´ï¼‰
        t1.setPriority(Thread.MIN_PRIORITY);//1
        t2.setPriority(2);
        t3.setPriority(3);
        t4.setPriority(4);
        t5.setPriority(5);
        t6.setPriority(Thread.MAX_PRIORITY);//10

        //å¯åŠ¨
        t1.start();
        t2.start();
        t3.start();
        t4.start();
        t5.start();
        t6.start();
    }
}

class MyPriority implements Runnable {
    @Override
    public void run() {
        System.out.println(Thread.currentThread().getName() + "-->" + Thread.currentThread().getPriority());
    }
}
```

### 4. å®ˆæŠ¤çº¿ç¨‹(daemon)

#### 4.1 è¯¦è§£

- çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·ç°ç¨‹(é»˜è®¤å°±æ˜¯ç”¨æˆ·çº¿ç¨‹)å’Œå®ˆæŠ¤çº¿ç¨‹
  ```java
  //å°†threadçº¿ç¨‹è®¾ä¸ºå®ˆæŠ¤çº¿ç¨‹ Daemonï¼šå®ˆæŠ¤çº¿ç¨‹
  thread.setDaemon(true);//é»˜è®¤æ˜¯falseè¡¨ç¤ºæ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œä¸æ˜¯å®ˆæŠ¤çº¿ç¨‹
  ```
- è™šæ‹Ÿæœºå¿…é¡»ç¡®ä¿ã€Œç”¨æˆ·çº¿ç¨‹ã€æ‰§è¡Œå®Œæ¯•
- è™šæ‹Ÿæœºä¸ç”¨ç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯•
- å¦‚ï¼Œåå°è®°å½•æ“ä½œæ—¥å¿—ï¼Œç›‘æ§å†…å­˜ï¼Œåƒåœ¾å›æ”¶ç­‰å¾…

> æ³¨ï¼š
>
> 1. è™šæ‹Ÿæœºä¸ä¼šç®¡å®ˆæŠ¤çº¿ç¨‹ï¼Œå…¶ä»–çº¿ç¨‹è·‘å®Œåä¸ç®¡å®ˆæŠ¤çº¿ç¨‹æ˜¯å¦è·‘å®Œï¼Œè™šæ‹Ÿæœºéƒ½ä¼šå…³é—­
> 2. è™šæ‹Ÿæœºå…³é—­éœ€è¦æ—¶é—´ï¼Œå› æ­¤å®ˆæŠ¤çº¿ç¨‹åœ¨ç”¨æˆ·çº¿ç¨‹è·‘å®Œåä»ä¼šè¿è¡Œä¸€æ®µæ—¶é—´

#### 4.2 ä»£ç æ¼”ç¤º

```java
//ä¸Šå¸å®ˆæŠ¤ä½ ç›´åˆ°ä½ æ­»å»
public class TestDaemon {
    public static void main(String[] args) {
        God god = new God();
        You you = new You();

        Thread thread = new Thread(god);
        thread.setDaemon(true);//é»˜è®¤æ˜¯falseè¡¨ç¤ºæ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œtrueä¸ºå®ˆæŠ¤çº¿ç¨‹

        thread.start();//ä¸Šå¸ å®ˆæŠ¤çº¿ç¨‹  è™šæ‹Ÿæœºä¸ä¼šç®¡å®ˆæŠ¤çº¿ç¨‹ï¼Œå…¶ä»–çº¿ç¨‹è·‘å®Œåä¸ç®¡å®ˆæŠ¤çº¿ç¨‹æ˜¯å¦è·‘å®Œï¼Œè™šæ‹Ÿæœºä»ä¼šç»“æŸï¼Œè™šæ‹Ÿæœºå…³é—­éœ€è¦æ—¶é—´ï¼Œå› æ­¤å®ˆæŠ¤çº¿ç¨‹åœ¨ç”¨æˆ·çº¿ç¨‹è·‘å®Œåä»ä¼šè¿è¡Œä¸€æ®µæ—¶é—´

        new Thread(you).start();//ä½  ç”¨æˆ·çº¿ç¨‹å¯åŠ¨
    }
}

//ä¸Šå¸ ä¸Šå¸ä¸€ç›´åœ¨ä¿ä½‘ç€ä½ ï¼Œç›´åˆ°ä½ æ­»å»
class God implements Runnable {
    @Override
    public void run() {
        while (true) {
            System.out.println("ä¸Šå¸ä¿ä½‘ç€ä½ ");
        }
    }
}

//ä½  æ´»äº†16500å¤©
class You implements Runnable {
    @Override
    public void run() {
        for (int i = 0; i < 36500; i++) {
            System.out.println("ä»Šå¤©ä½ æˆåŠŸç”Ÿå­˜äº†" + i + "å¤©");
        }
        System.out.println("====goodbyeï¼world====");
    }
}
```

### 5.  çº¿ç¨‹åŒæ­¥

#### 5.1 å‘ç°é—®é¢˜ï¼š

- å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€å—å­˜åº“ç©ºé—´ï¼Œå¸¦æ¥æ–¹ä¾¿çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†ã€Œå¹¶å‘ã€é—®é¢˜

- å¹¶å‘ï¼šåŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ

- å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å¯¹è±¡ï¼Œä¸”æŸäº›çº¿ç¨‹è¿˜æƒ³ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°±éœ€è¦ã€Œçº¿ç¨‹åŒæ­¥ã€æ¥è§£å†³è¿™ä¸ªé—®é¢˜

  > æ¯”å¦‚é“¶è¡Œï¼š
  > åŒä¸€å¼ é“¶è¡Œå¡å­˜äº†300w RMB
  > ä½ å’Œä½ åª³å¦‡åŒæ—¶å–é’±å‡ºç°å¹¶å‘é—®é¢˜ï¼Œ
  > ä½ åœ¨æ‰‹æœºä¸Šå–100RMBï¼Œ
  > ä½ åª³å¦‡åœ¨é“¶è¡Œå–300w RMBï¼Œ
  > è¿™æ ·å°±ä¼šè·å¾—300.01w RMB,å‡ºç°é—®é¢˜ï¼Œ
  > é“¶è¡Œè¡€äº100RMB
  
- å½“å‘ç”Ÿå¹¶å‘æ—¶ï¼Œå¦‚ä¹°ç¥¨ï¼Œå¤šä¸ªäººåŒæ—¶ä¹°ï¼Œä»–ä»¬éƒ½å‘ç°å”®ç¥¨å¤„è¿˜æœ‰ä¸€å¼ ç¥¨ï¼Œå°±æŠŠä¸€å¼ ç¥¨æ‹·è´çš„è‡ªå·±çš„å†…å­˜åŒºåŸŸï¼Œç„¶åè¿›è¡Œè´­ä¹°ï¼Œç»“æœæ˜¯æ¯äººä¹°äº†ä¸€å¼ ç¥¨ï¼Œè´­ä¹°æ—¶å”®ç¥¨å¤„ç¥¨æ•°`--`ï¼Œå”®ç¥¨å¤„è¿˜æœ‰è´Ÿæ•°å¼ ç¥¨ï¼‰

#### 5.2 è§£å†³é—®é¢˜ã€Œé˜Ÿåˆ— + é”ã€

- çº¿ç¨‹åŒæ­¥å…¶å®å°±æ˜¯ä¸€ç§**ç­‰å¾…æœºåˆ¶**

- è§£å†³æ–¹å¼ï¼šã€Œé˜Ÿåˆ— + é”ã€

  - **ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§**

    > eg:ä¸Šå•æ‰€
    >
    > å¤šä¸ªç”¨æˆ·åŒæ—¶ä¸Šå•æ‰€ï¼Œéœ€è¦æ’é˜Ÿ
    > ä¸Šå•æ‰€çš„äººä¼šæŠŠå‘ä¸Šçš„é—¨åé”ä¿è¯å…¶ä½™äººä¸ä¼šè¿›å…¥
    >
    > å½“ä¸Šå®Œå•æ‰€åæ‰“å¼€é”
    > é˜Ÿåˆ—ä¸­ä¸‹ä¸€äººè¿›å…¥

    - å¤šä¸ªéœ€è¦åŒæ—¶è®¿é—®æ­¤å¯¹è±¡çš„çº¿ç¨‹è¿›å…¥è¿™ä¸ªå¯¹è±¡çš„ã€Œå¯¹è±¡ç­‰å¾…æ± ã€å½¢æˆ**é˜Ÿåˆ—**ï¼Œç­‰å¾…å‰é¢çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹å†ä½¿ç”¨

    - ä¸ºä¿è¯é˜Ÿåˆ—ï¼Œåœ¨è®¿é—®æ—¶åŠ å…¥äº†**é”æœºåˆ¶(synchronized)**ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å¾—å¯¹è±¡çš„æ’ä»–é”åï¼Œç‹¬å èµ„æºï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼Œä½¿ç”¨åé‡Šæ”¾é”å³å¯

    - æ¯ä¸ªçº¿ç¨‹**åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜äº¤äº’**ï¼Œå†…å­˜æ§åˆ¶ä¸å½“ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´

      > eg:ä¹°ç¥¨ï¼Œå¤šä¸ªäººåŒæ—¶ä¹°ï¼Œä»–ä»¬éƒ½å‘ç°å”®ç¥¨å¤„åªæœ‰ä¸€å¼ ç¥¨æ—¶ï¼Œå°±æŠŠå”®ç¥¨å¤„è¿˜æœ‰ä¸€å¼ ç¥¨æ‹·è´çš„è‡ªå·±çš„å†…å­˜åŒºåŸŸï¼Œç„¶åè¿›è¡Œè´­ä¹°ï¼Œç»“æœæ˜¯æ¯äººä¹°äº†ä¸€å¼ ç¥¨ï¼Œè´­ä¹°æ—¶å”®ç¥¨å¤„ç¥¨æ•°`--`ï¼Œç»“æœæ˜¯å”®ç¥¨å¤„è¿˜æœ‰è´Ÿæ•°å¼ ç¥¨ï¼‰

  - **é˜Ÿåˆ— + é”ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜**

    - ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ä¼šå¯¼è‡´å…¶ä»–æ‰€æœ‰éœ€è¦æ­¤é”çš„çº¿ç¨‹**æŒ‚èµ·**(æ€§èƒ½å˜æ…¢)
    - åœ¨å¤šçº¿ç¨‹ç«äº‰ä¸‹ï¼ŒåŠ é”ï¼Œé‡Šæ”¾é”ä¼šå¯¼è‡´æ¯”è¾ƒå¤šçš„ã€Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€å’Œã€Œè°ƒåº¦å»¶æ—¶ã€ï¼Œå¼•èµ·æ€§èƒ½é—®é¢˜(æ€§èƒ½å˜æ…¢)
    - å¦‚æœä¸€ä¸ªä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ç­‰å¾…ä¸€ä¸ªä¼˜å…ˆçº§ä½çš„çº¿ç¨‹é‡Šæ”¾é”ä¼šå¯¼è‡´**ä¼˜å…ˆçº§å€’ç½®**ï¼Œå¼•èµ·æ€§èƒ½é—®é¢˜

#### 5.3 synchronizedé”çš„ä¸¤ç§ç”¨æ³•

synchronized()æ–¹æ³• å’Œ synchronizedå—

- synchronized()æ–¹æ³•åªèƒ½é”this
- æ–¹æ³•é‡Œé¢éœ€è¦ä¿®æ”¹çš„å†…å®¹æ‰éœ€è¦é”ï¼Œé”çš„å¤ªå¤šä¼šæµªè´¹èµ„æºï¼Œç”±æ­¤äº§ç”Ÿsynchronizedå—
- synchronized(Obj){}ä»£ç å—å¯ä»¥é”ä»»æ„å¯¹è±¡ï¼Œé”ä½çš„å¯¹è±¡å°±æ˜¯å˜åŒ–çš„å¯¹è±¡ï¼Œéœ€è¦å¢åˆ æ”¹çš„å¯¹è±¡

##### 5.3.1 synchronized()æ–¹æ³•

```java
 public synchronized void method(int args){}
```

- åŒæ­¥æ–¹æ³•çš„Objã€ŒåŒæ­¥ç›‘è§†å™¨ã€å°±æ˜¯this
- synchronizedæ–¹æ³•æ§åˆ¶å¯¹ã€Œå¯¹è±¡ã€çš„è®¿é—®ï¼Œæ¯ä¸ªå¯¹è±¡å¯¹åº”ä¸€æŠŠé”ï¼Œæ¯ä¸ªsynchronizedæ–¹æ³•å¿…é¡»è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡çš„é”æ‰èƒ½æ‰§è¡Œsynchronizedæ–¹æ³•ï¼Œå¦åˆ™çº¿ç¨‹ä¼šé˜»å¡
- æ–¹æ³•ä¸€æ—¦æ‰§è¡Œï¼Œå°±ç‹¬å è¯¥é”ï¼Œç›´åˆ°è¯¥æ–¹æ³•è¿”å›æ‰é‡Šæ”¾é”ï¼Œåé¢è¢«é˜»å¡çš„çº¿ç¨‹æ‰èƒ½è·å¾—è¿™ä¸ªé”ç»§ç»­æ‰§è¡Œ
- ç¼ºé™·ï¼šè‹¥å°†ä¸€ä¸ªå¤§çš„æ–¹æ³•ç”³æ˜ä¸ºsynchronizedå°†ä¼šå½±å“æ•ˆç‡ï¼ˆä¸é«˜æ•ˆï¼‰

##### 5.3.2 synchronizedåŒæ­¥å—

```java 
synchronized(Obj){}
```

- äº§ç”Ÿï¼šæ–¹æ³•é‡Œé¢éœ€è¦ä¿®æ”¹çš„å†…å®¹æ‰éœ€è¦é”ï¼Œé”çš„å¤ªå¤šä¼šæµªè´¹èµ„æºï¼Œç”±æ­¤äº§ç”Ÿsynchronizedå—
- Obj å°±æ˜¯é”ä½çš„å¯¹è±¡ï¼Œç§°ä¹‹ä¸ºã€ŒåŒæ­¥ç›‘è§†å™¨ã€
  - Obj å¯ä»¥æ˜¯**ä»»ä½•å¯¹è±¡**ï¼Œä½†æ˜¯æ¨èä½¿ç”¨å…±äº«èµ„æºä½œä¸ºåŒæ­¥ç›‘è§†å™¨
  - é”ä½çš„å¯¹è±¡å°±æ˜¯å˜åŒ–çš„å¯¹è±¡ï¼Œéœ€è¦å¢åˆ æ”¹çš„å¯¹è±¡
  - åŒæ­¥æ–¹æ³•ä¸­æ— éœ€æŒ‡å®šåŒæ­¥ç›‘è§†å™¨ï¼Œå› ä¸ºåŒæ­¥æ–¹æ³•çš„åŒæ­¥ç›‘è§†å™¨å°±æ˜¯thisï¼Œå°±æ˜¯è¿™æ¢ä¸ªå¯¹è±¡æœ¬èº«ï¼Œæˆ–è€…æ˜¯ classã€åå°„ä¸­ã€‘
- Objã€ŒåŒæ­¥ç›‘è§†å™¨ã€çš„æ‰§è¡Œè¿‡ç¨‹
  1. ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé”å®šåŒæ­¥ç›‘è§†å™¨ï¼Œæ‰§è¡Œå…¶ä¸­ä»£ç 
  2. ç¬¬äºŒä¸ªçº¿ç¨‹è®¿é—®ï¼Œå‘ç°åŒæ­¥ç›‘è§†å™¨è¢«é”å®šï¼Œæ— æ³•è®¿é—®
  3. ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¿é—®å®Œæ¯•ï¼Œè§£é”åŒæ­¥ç›‘è§†å™¨
  4. ç¬¬äºŒä¸ªçº¿ç¨‹è®¿é—®ï¼Œå‘ç°åŒæ­¥ç›‘è§†å™¨æ²¡æœ‰é”ï¼Œç„¶åé”å®šå¹¶è®¿é—®



#### 5.4 æ¡ˆä¾‹

##### 5.4.1 ä¹°ç¥¨ï¼ˆsynchronizedæ–¹æ³•ï¼‰

```Java
//ä¸å®‰å…¨çš„ä¹°ç¥¨(ä¼šå‡ºç°å¤šä¸ªçº¿ç¨‹åŒæ—¶å‘ç°è¿˜æœ‰1å¼ ç¥¨ï¼Œå¹¶å°†æœ‰ä¸€å¼ ç¥¨çš„ä¿¡æ¯æ‹·è´åˆ°è‡ªå·±å†…å­˜ç©ºé—´ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¹°è¿™ä¸€å¼ ç¥¨ï¼Œå”®ç¥¨å¤„ç¥¨æ•°å¤šæ¬¡--ï¼Œå‡ºç°è´Ÿæ•°)
//è§£å†³æ–¹å¼ï¼šsynchronizedæ–¹æ³•ï¼ˆé”çš„æ˜¯thisï¼‰
public class UnsafeBuyTicket {
    public static void main(String[] args) {
        BuyTicket station = new BuyTicket();

        new Thread(station,"è‹¦é€¼çš„æˆ‘").start();
        new Thread(station,"ç‰›é€¼çš„ä½ ä»¬").start();
        new Thread(station,"å¯æ¶çš„é»„ç‰›å…š").start();
    }
}

class BuyTicket implements Runnable {
    private int ticketNums = 10;
    boolean flag = true;//å¤–éƒ¨åœæ­¢æ–¹å¼

    @Override
    public void run() {
        //ä¹°ç¥¨
        while (flag) {
            try {
                buy();
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }
    }

    //ä¹°ç¥¨
    private void buy() throws InterruptedException {
        //åˆ¤æ–­æ˜¯å¦æœ‰ç¥¨
        if (ticketNums <= 0) {
            flag = false;
            return;
        }
        Thread.sleep(100);
        //ä¹°ç¥¨
        System.out.println(Thread.currentThread().getName() + "æ‹¿åˆ°" + ticketNums--);
    }
}
```

##### 5.4.2 é›†åˆæ·»åŠ æ•°æ®(åŒæ­¥ä»£ç å—)

```java
//çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆ(ä¸¤ä¸ªçº¿ç¨‹åœ¨åŒä¸€ç¬é—´å¯èƒ½ä¼šåœ¨åŒä¸€ä¸ªä½ç½®æ·»åŠ æ•°æ®ï¼Œæ•°æ®ä¼šè¢«è¦†ç›–æ‰ï¼Œä¹Ÿå°±æ˜¯æ·»åŠ çš„ä½ç½®ä¸å®‰å…¨)
//è§£å†³æ–¹å¼ï¼šsynchronizedåŒæ­¥å—ï¼ˆé”çš„æ˜¯å˜åŒ–çš„å¯¹è±¡ï¼‰
public class UnsafeList {
    public static void main(String[] args) throws InterruptedException {
        List<String> list = new ArrayList<>();
        for (int i = 0; i < 10000; i++) {
            new Thread(()-> {
                //synchronizedå—ï¼ˆé”çš„æ˜¯å˜åŒ–çš„å¯¹è±¡listï¼‰
                synchronized (list) {
                    list.add(Thread.currentThread().getName());//æ·»åŠ æ—¶ä¼šåœ¨æœ€åä¸€ä¸ªä½ç½®æ·»åŠ 
                }
            }).start();
        }
        Thread.sleep(3000);
        System.out.println(list.size());//æ‰“å°é›†åˆçš„å…ƒç´ ä¸ªæ•°ï¼Œå¯èƒ½å°‘äº10000
    }
}
```



## äºŒ. Lambdaè¡¨è¾¾å¼

### 1.ç®€ä»‹åŠè¯­æ³•

lambdaè¡¨è¾¾å¼æ˜¯å‡½æ•°å¼ç¼–ç¨‹

**å‰æ**

> å¿…é¡»æ˜¯å‡½æ•°å¼æ¥å£

ç†è§£å‡½æ•°å¼æ¥å£Functional interface(å‡½æ•°å¼æ¥å£) æ˜¯å­¦ä¹ Java8 lambdaçš„å…³é”®æ‰€åœ¨

**è¯­æ³•**

- ä»»ä½•æ¥å£ï¼Œå¦‚æœåªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ª**å‡½æ•°å¼æ¥å£**
  ```java
  public interface Runnable {
      public abstract void run();
  }
  ```

- å¯¹äºå‡½æ•°å¼æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡**lambdaè¡¨è¾¾å¼**æ¥åˆ›å»ºè¯¥æ¥å£çš„å¯¹è±¡
  ```java
  //å½“æŠ½è±¡æ–¹æ³•éœ€è¦ä¼ å‚æ—¶,()å†…å¯ä»¥ä¼ å‚æ•°
  //å¦‚ISum i = (int a) -> {};
  Runnable r1 = () -> {
      System.out.println("åœ¨æ­¤å†™Runnableæ¥å£å†…çš„å”¯ä¸€æŠ½è±¡æ–¹æ³•run()çš„æ–¹æ³•ä½“");
  }//ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªç±»å®ç°äº†Runnableæ¥å£
  ```

- ç®€åŒ–

  1. å¯ä»¥å»æ‰å‚æ•°ç±»å‹(å¤šä¸ªå‚æ•°æ—¶ä¹Ÿå¯çœç•¥)
  2. å¯ä»¥å»æ‰æ‹¬å·(å¤šä¸ªå‚æ•°æ—¶ä¸å¯çœç•¥æ‹¬å·)
  3. å¯ä»¥å»æ‰èŠ±æ‹¬å·(ä»…é™åªæœ‰ä¸€è¡Œæ–¹æ³•ä½“ï¼Œå¦‚æœæœ‰å¤šè¡Œä»éœ€èŠ±æ‹¬å·åŒ…è£¹)

### 2.Lambdaè¡¨è¾¾å¼çš„è¯ç”Ÿ

#### 2.1 ç®€åŒ–è¿‡ç¨‹ï¼š

```mermaid
graph LR
a([1.å¤–éƒ¨ç±»])-.å®ç°.->b[[æ¥å£]]
c([2.é™æ€å†…éƒ¨ç±»])-.å®ç°.->b
d([3.å±€éƒ¨å†…éƒ¨ç±»])-.å®ç°.->b
e([4.åŒ¿åå†…éƒ¨ç±»])-.å€ŸåŠ©.->b
f([5.Lambdaè¡¨è¾¾å¼])-.åˆ©ç”¨.->b
a--ç®€åŒ–-->c
c--ç®€åŒ–-->d
d--ç®€åŒ–-->e
e--ç®€åŒ–-->f
```

#### 2.2 ä»£ç æ¼”ç¤º

##### 2.2.1 Lambdaçš„æ¼”å˜

```java
/*
æ¨å¯¼Lambdaè¡¨è¾¾å¼
æ³¨é‡Š2->5é€æ¸ç®€åŒ–
 */
public class TestLambda1 {
    //3.é™æ€å†…éƒ¨ç±»
    static class Like2 implements ILike {
        @Override
        public void lambda() {
            System.out.println("I like Lambda2");
        }
    }

    public static void main(String[] args) {
        ILike like = new Like();//å®ç°ç±»
        like.lambda();

        like = new Like2();//é™æ€å†…éƒ¨ç±»
        like.lambda();

        //4.å±€éƒ¨å†…éƒ¨ç±»
        class Like3 implements ILike {
            @Override
            public void lambda() {
                System.out.println("I like Lambda3");
            }
        }
        like = new Like3();
        like.lambda();

        //5.åŒ¿åå†…éƒ¨ç±»,æ²¡æœ‰ç±»åç§°ï¼Œå¿…é¡»å€ŸåŠ©æ¥å£æˆ–è€…çˆ¶ç±»
        like = new ILike() {
            @Override
            public void lambda() {
                System.out.println("I like Lambda4");
            }
        };
        like.lambda();

        //6.ç”¨Lambdaç®€åŒ–
        like = () -> {
            System.out.println("I like Lambda5");
        };
        like.lambda();
    }
}
//1. å®šä¹‰ä¸€ä¸ªå‡½æ•°å¼æ¥å£
interface ILike {
    void lambda();
}
//2.å®ç°ç±»
class Like implements ILike {

    @Override
    public void lambda() {
        System.out.println("I like Lambda1");
    }
}
```

##### ç®€åŒ–Lambdaè¡¨è¾¾å¼

```java
public class TestLambda2 {
    public static void main(String[] args) {
        ILove love = null;

        //4.0 lambda
        love = (String a)->{
            System.out.println("I love you-->" + a);
        };
        love.love("å°é’1");

        //4.1 ç®€åŒ–1ï¼šå»æ‰å‚æ•°ç±»å‹(å¤šä¸ªå‚æ•°æ—¶ä¹Ÿå¯çœç•¥)
        love = (a)->{
            System.out.println("I love you-->" + a);
        };
        love.love("å°é’2");

        //4.2 ç®€åŒ–2ï¼šå»æ‰æ‹¬å·(å¤šä¸ªå‚æ•°æ—¶ä¸å¯çœç•¥æ‹¬å·)
        love = a->{
            System.out.println("I love you-->" + a);
        };
        love.love("å°é’3");

        //4.3ï¼šå»æ‰èŠ±æ‹¬å·(ä»…é™åªæœ‰ä¸€è¡Œæ–¹æ³•ä½“ï¼Œå¦‚æœæœ‰å¤šè¡Œä»éœ€èŠ±æ‹¬å·åŒ…è£¹)
        love = a-> System.out.println("I love you-->" + a);
        love.love("å°é’4");

    }
}
interface ILove {
    void love(String a);
}
```

## ä¸‰. é™æ€ä»£ç†æ¨¡å¼

### 3.1 ä»‹ç»

**é™æ€ä»£ç†æ¨¡å¼ï¼š**
    çœŸå®å¯¹è±¡(ä¸ªäºº)å’Œä»£ç†å¯¹è±¡(å©šä»‹å…¬å¸)éƒ½è¦å®ç°åŒä¸€ä¸ªæ¥å£(å¹²ä¸€ä»¶äº‹)
    ä»£ç†å¯¹è±¡ä»£ç†çœŸå®è§’è‰²(åˆ›å»ºä»£ç†å¯¹è±¡æ—¶è¦ä¼ å…¥ç›®æ ‡å¯¹è±¡)
**å¥½å¤„ï¼š**
    ä»£ç†å¯¹è±¡å¯ä»¥åšå¾ˆå¤šçœŸå®å¯¹è±¡åšä¸äº†çš„äº‹(å¸ƒç½®ç°åœº)
    çœŸå®å¯¹è±¡ä¸“æ³¨äºè‡ªå·±çš„äº‹æƒ…(ç»“å©š)

**Threadæ˜¯ä»£ç†æ¨¡å¼**
		`new Thread(() -> System.out.println("æˆ‘çˆ±ä½ ")).start();`
		Threadç›¸å½“äºä»£ç†å¯¹è±¡
		()ç›¸å½“äºçœŸå®å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯Runnableå®ç°ç±»ï¼Œé‡å†™runæ–¹æ³•è°ƒç”¨run

### 3.2 ä»£ç æ¼”ç¤º

```java
public class StaticProxy {
    public static void main(String[] args) {
        You you = new You();//ä½ è¦ç»“å©š(çœŸå®å¯¹è±¡)

        WeddingCompany weddingCompany = new WeddingCompany(you);//å©šä»‹å…¬å¸å¸®åŠ©ä½ ç»“å©š(ä»£ç†å¯¹è±¡ä¼ å…¥çœŸå®å¯¹è±¡)
        weddingCompany.HappyMarry();//ä¸¤å¯¹è±¡å…±åŒå®Œæˆç»“å©š

        new WeddingCompany(new You()).HappyMarry();
    }
}

//ç»“å©š
interface Marry {
    //å¼€å¿ƒçš„ç»“å©š
    void HappyMarry();
}


//çœŸå®è§’è‰²ï¼Œä½  å»ç»“å©š çœŸå®å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦å®ç°åŒä¸€ä¸ªæ¥å£
//è¦å»ç»“å©šçš„ä½ ç±»
class You implements Marry {
    @Override
    public void HappyMarry() {
        System.out.println("ä½ ï¼šç»“å©šä¸­ï¼Œæ•²å¼€æ£®ï¼ï¼");
    }
}

//ä»£ç†è§’è‰²ï¼Œ å¸®åŠ©ä½ ç»“å©š çœŸå®å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦å®ç°åŒä¸€ä¸ªæ¥å£
//å©šä»‹å…¬å¸ç±»
class WeddingCompany implements Marry {
    private Marry target;
	
    //ä»£ç†å¯¹è±¡è¦æœ‰å‚æ•°ä¸ºçœŸå®å¯¹è±¡çš„æ„é€ æ–¹æ³•
    public WeddingCompany(Marry target) {
        this.target = target;
    }

    //å…¬å¸ä¸šåŠ¡
    @Override
    public void HappyMarry() {
        //ç»“å©šå‰
        before();
        //ä½ ç»“å©š
        this.target.HappyMarry();
        //ç»“å©šå
        after();

    }

    private void before() {
        System.out.println("å©šä»‹å…¬å¸ï¼šç»“å©šä¹‹å‰ï¼Œå¸ƒç½®ç°åœº");
    }
    private void after() {
        System.out.println("å©šä»‹å…¬å¸ï¼šç»“å©šä¹‹åï¼Œæ”¶å°¾æ¬¾");
    }

}
```

