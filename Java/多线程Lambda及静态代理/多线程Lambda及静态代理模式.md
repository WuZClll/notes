

[å¤šçº¿ç¨‹01ï¼šæ¦‚è¿°_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1V4411p7EF?p=1&vd_source=796ed40051b301bfa3a84ba357f4828c)çš„è‡ªå­¦ç¬”è®°

>1. [å¤šçº¿ç¨‹](##ä¸€. å¤šçº¿ç¨‹)
>2. [Lambdaè¡¨è¾¾å¼](##äºŒ. Lambdaè¡¨è¾¾å¼)
>3. [é™æ€ä»£ç†æ¨¡å¼](##ä¸‰.  é™æ€ä»£ç†æ¨¡å¼)
>
>

## ä¸€. å¤šçº¿ç¨‹

å¤šçº¿ç¨‹æ˜¯[é™æ€ä»£ç†](##ä¸‰. é™æ€ä»£ç†æ¨¡å¼)æ¨¡å¼

- çº¿ç¨‹å°±æ˜¯ç‹¬ç«‹çš„æ‰§è¡Œè·¯å¾„

- åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå³ä½¿æ²¡æœ‰è‡ªå·±åˆ›å»ºçº¿ç¨‹ï¼Œåå°ä¹Ÿä¼šæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¦‚ä¸»çº¿ç¨‹ï¼Œgcçº¿ç¨‹

- main()ç§°ä¹‹ä¸ºä¸»çº¿ç¨‹ï¼Œä¸ºç³»ç»Ÿçš„å…¥å£ï¼Œç”¨äºæ‰§è¡Œæ•´ä¸ªç¨‹åº

- åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå¦‚æœå¼€è¾Ÿäº†å¤šä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹çš„è¿è¡Œç”±**è°ƒåº¦å™¨(cpu)å®‰æ’è°ƒåº¦**ï¼Œè°ƒåº¦å™¨æ˜¯ä¸æ“ä½œç³»ç»Ÿç´§å¯†ç›¸å…³çš„ï¼Œå…ˆåé¡ºåºæ˜¯ä¸èƒ½äººä¸ºçš„å¹²é¢„çš„

- å¯¹åŒä¸€ä»½èµ„æºæ“ä½œæ—¶ï¼Œä¼šå­˜åœ¨èµ„æºæŠ¢å¤ºçš„é—®é¢˜ï¼Œéœ€è¦åŠ å…¥**å¹¶å‘æ§åˆ¶**

- çº¿ç¨‹ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ï¼Œå¦‚cpuè°ƒåº¦æ—¶é—´ï¼Œå¹¶å‘æ§åˆ¶å¼€é”€

- æ¯ä¸ªçº¿ç¨‹åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜äº¤äº’ï¼Œå†…å­˜æ§åˆ¶ä¸å½“ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´

  > å½“å‘ç”Ÿå¹¶å‘æ—¶ï¼Œå¦‚ä¹°ç¥¨ï¼Œå¤šä¸ªäººåŒæ—¶ä¹°ï¼Œä»–ä»¬éƒ½å‘ç°å”®ç¥¨å¤„è¿˜æœ‰ä¸€å¼ ç¥¨ï¼Œå°±æŠŠä¸€å¼ ç¥¨æ‹·è´çš„è‡ªå·±çš„å†…å­˜åŒºåŸŸï¼Œç„¶åè¿›è¡Œè´­ä¹°ï¼Œç»“æœæ˜¯æ¯äººä¹°äº†ä¸€å¼ ç¥¨ï¼Œè´­ä¹°æ—¶å”®ç¥¨å¤„ç¥¨æ•°`--`ï¼Œå”®ç¥¨å¤„è¿˜æœ‰è´Ÿæ•°å¼ ç¥¨ï¼‰

### 1. çº¿ç¨‹çš„ä¸‰ç§å®ç°æ–¹å¼

> 1. [ç»§æ‰¿Threadç±»(é‡ç‚¹)](####1.1 ç»§æ‰¿Threadç±»(é‡ç‚¹))
>    - ä¸å»ºè®®ä½¿ç”¨ï¼ŒOOPå•ç»§æ‰¿å±€é™æ€§
>      - å•ç»§æ‰¿ï¼šjavaåªèƒ½ç»§æ‰¿ä¸€ä¸ªï¼Œä¸èƒ½ç»§æ‰¿å¤šä¸ªï¼Œåªèƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»
> 2. [å®ç°Runnableæ¥å£(é‡ç‚¹)](####1.2 å®ç°Runnableæ¥å£(é‡ç‚¹))
>    - æ¨èä½¿ç”¨ï¼Œé¿å…å•ç»§æ‰¿å±€é™æ€§ï¼Œçµæ´»æ–¹ä¾¿ï¼Œæ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨
> 3. [å®ç°Callableæ¥å£(äº†è§£)](####1.3 å®ç°Callableæ¥å£(äº†è§£))

æ³¨ï¼š

>1å’Œ2ä¸¤ç§æ–¹å¼æœ¬è´¨æ—¶ä¸€æ ·çš„ï¼š
>
>1. æºç ä¸­Threadç±»å®ç°äº†Runnableæ¥å£
>   - ç»§æ‰¿Threadç±»ä¾¿ç­‰åŒäºå®ç°äº†Runnableæ¥å£ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ç±»äº†
>2. Threadç±»ä¸­æœ‰start()sleep()ç­‰æ–¹æ³•
>   - ç»§æ‰¿Threadç±»å°±æœ‰äº†start()ç­‰æ–¹æ³•
>   - å®ç°Runnableæ¥å£è¿™ä¸ªæ–¹å¼æ²¡æœ‰è¿™äº›æ–¹æ³•ï¼Œéœ€è¦ç”¨Threadä»£ç†ä½¿ç”¨è¿™äº›æ–¹æ³•
>     - Threadä»£ç†å°±æ˜¯ç”¨Threadå¸¦å‚æ„é€ æ–¹æ³•å°†Runnableæ¥å£å®ç°ç±»å¯¹è±¡ä½œä¸ºå‚æ•°åˆ›å»ºThreadå¯¹è±¡ï¼Œè°ƒç”¨start()ç­‰æ–¹æ³•

#### 1.1 ç»§æ‰¿Threadç±»(é‡ç‚¹)

1. è‡ªå®šä¹‰çº¿ç¨‹ç±»ç»§æ‰¿`extends Thread`

   ```java
   public class TestThread1 extends Thread{}
   ```

2. é‡å†™`run()`æ–¹æ³•ï¼Œç¼–å†™çº¿ç¨‹æ‰§è¡Œä½“
   ```java
   @Override
       public void run(){}
   ```
   
3. *åˆ›å»ºè‡ªå®šä¹‰çº¿ç¨‹ç±»å¯¹è±¡ï¼Œè°ƒç”¨start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹*(ä¸å®ç°[Runnableæ¥å£](###2. å®ç°Runnableæ¥å£)æœ‰åŒºåˆ«)
   
   ```java
   TestThread1 testThread1 = new TestThread1();
   testThread1.start();
   ```

##### 1.1.1 æ¼”ç¤º

```java
// åˆ›å»ºçº¿ç¨‹æ–¹å¼1ï¼šç»§æ‰¿Threadç±»
public class TestThread1 extends Thread{
    @Override
    public void run() {
        //runæ–¹æ³•çº¿ç¨‹ä½“
        for (int i = 0; i < 2000; i++) {
            System.out.println("æˆ‘åœ¨çœ‹ä»£ç --" + i);
        }
    }

    public static void main(String[] args) {
        //mainçº¿ç¨‹ï¼Œä¸»çº¿ç¨‹
        //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡
        TestThread1 testThread1 = new TestThread1();
        //è°ƒç”¨start()æ–¹æ³•å¼€å¯çº¿ç¨‹
        testThread1.start();//çº¿ç¨‹ä¸ä¸€å®šç«‹å³æ‰§è¡ŒCPUå®‰æ’è°ƒåº¦

        for (int i = 0; i < 2000; i++) {
            System.out.println("æˆ‘åœ¨å­¦ä¹ å¤šçº¿ç¨‹--" + i);
        }
    }
}
```

##### 1.1.2 æ¡ˆä¾‹ 

###### 1.1.2.1 Threadå®ç°å¤šçº¿ç¨‹åŒæ­¥ä¸‹è½½å›¾ç‰‡

> é¦–å…ˆéœ€è¦jaråŒ…([Commons IO â€“ Download Apache Commons IO](https://commons.apache.org/proper/commons-io/download_io.cgi))ç”¨äºä¸‹è½½ç½‘ç»œå›¾ç‰‡

```java
import org.apache.commons.io.FileUtils;

import java.io.File;
import java.io.IOException;
import java.net.URL;
// ç»ƒä¹ 
//  Threadå®ç°å¤šçº¿ç¨‹åŒæ­¥ä¸‹è½½å›¾ç‰‡
//  é¦–å…ˆéœ€è¦å¼•å…¥jaråŒ…
public class TestThread2 extends Thread{
    private String url;//ç½‘ç»œå›¾ç‰‡åœ°å€
    private String name;//ä¿å­˜çš„æ–‡ä»¶å

    public TestThread2(String url, String name) {
        this.url = url;
        this.name = name;
    }
    @Override
    public void run() {
        WebDownloader webDownloader = new WebDownloader();
        webDownloader.downloader(url, name);
        System.out.println("ç°åœ¨çš„æ–‡ä»¶åä¸ºï¼š" + name);
    }

    public static void main(String[] args) {
        TestThread2 t1 = new TestThread2("https://img-home.csdnimg.cn/images/20230213094345.jpg", "1.jpg");
        TestThread2 t2 = new TestThread2("https://img-home.csdnimg.cn/images/20230213094345.jpg", "2.jpg");
        TestThread2 t3 = new TestThread2("https://img-home.csdnimg.cn/images/20230213094345.jpg", "3.jpg");
        t1.start();
        t2.start();
        t3.start();
    }
}

class WebDownloader {
    //ä¸‹è½½æ–¹æ³•
    public void downloader(String url, String name) {
        try {
            FileUtils.copyURLToFile(new URL(url), new File(name));//æŠŠä¸€ä¸ªç½‘ç»œurlå˜ä¸ºå›¾ç‰‡ä¸‹è½½ä¸ºname
        } catch (IOException e) {
            e.printStackTrace();
            System.out.println("IOå¼‚å¸¸,downloadæ–¹æ³•å‡ºç°é—®é¢˜");
        }
    }
}
```

#### 1.2 å®ç°Runnableæ¥å£(é‡ç‚¹)

1. å®šä¹‰ç±»ï¼Œå®ç°Runnableæ¥å£
   ```java
   public class TestThread3 implements Runnable{}
   ```
   
2. å®ç°run()æ–¹æ³•ï¼Œç¼–å†™çº¿ç¨‹æ‰§è¡Œä½“
   ```java
   @Override
       public void run() {}
   ```
   
3. åˆ›å»ºRunnableæ¥å£çš„å®ç°ç±»å¯¹è±¡
   ```java
   TestThread3 testThread3 = new TestThread3();
   ```
   
4. *åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œè°ƒç”¨çº¿ç¨‹å¯¹è±¡è°ƒç”¨start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹*, <u>ä»£ç†</u>   (ä¸[ç»§æ‰¿Threadç±»](###1. ç»§æ‰¿Threadç±»)æœ‰åŒºåˆ«)

   ```java
   Thread thread = new Thread(testThread3);//ä»£ç†
   thread.start();
   ```
   
   

##### 1.2.1 æ¼”ç¤º

```java
public class TestThread3 implements Runnable{
    @Override
    public void run() {
        //runæ–¹æ³•çº¿ç¨‹ä½“
        for (int i = 0; i < 2000; i++) {
            System.out.println("æˆ‘åœ¨çœ‹ä»£ç --" + i);
        }
    }

    public static void main(String[] args) {
        //mainçº¿ç¨‹ï¼Œä¸»çº¿ç¨‹
        //åˆ›å»ºä¸€ä¸ªRunnableæ¥å£çš„å®ç°ç±»(ä¸€ä»½èµ„æº)
        TestThread3 testThread3 = new TestThread3();
        
/*
        //åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œé€šè¿‡çº¿ç¨‹å¯¹è±¡æ¥å¼€å¯çº¿ç¨‹ï¼Œ(å¤šæ¬¡ä»£ç†)
        Thread thread1 = new Thread(testThread3);//å‚æ•°: runnableæ¥å£çš„å®ç°ç±»
        Thread thread2 = new Thread(testThread3);
        //è°ƒç”¨start()æ–¹æ³•å¼€å¯çº¿ç¨‹
        thread.start();
        thread.start();
*/
        
        //åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œé€šè¿‡çº¿ç¨‹å¯¹è±¡æ¥å¼€å¯çº¿ç¨‹ï¼Œ(å¤šæ¬¡ä»£ç†)
        new Thread(testThread3).start();//åŒä¸Šä¸¤è¡Œä»£ç 
        new Thread(testThread3).start();

        for (int i = 0; i < 2000; i++) {
            System.out.println("æˆ‘åœ¨å­¦ä¹ å¤šçº¿ç¨‹--" + i);
        }
    }
}
```

##### 1.2.2 æ¡ˆä¾‹(å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€åŒä¸ªå¯¹è±¡)

###### 1.2.2.1 ä¹°ç«è½¦ç¥¨

```java
//å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå¯¹è±¡
//ä¹°ç«è½¦ç¥¨

//å‘ç°é—®é¢˜ å¤šä¸ªèµ„æºæ“ä½œåŒä¸€ä¸ªèµ„æºçš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•°æ®ç´Šä¹±
//	æœ‰æ—¶æŠ¢åˆ°åŒä¸€å¼ ç¥¨ï¼Œåˆæœ‰æ—¶æŠ¢åˆ°0æˆ–-1å¼ ç¥¨
public class TestThread4 implements Runnable{

    //ç¥¨æ•°
    int tickNumbers = 10;

    @Override
    public void run() {
        while (true) {
            if (tickNumbers <= 0) {
                break;
            }
            //æ¨¡æ‹Ÿå»¶æ—¶
            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            System.out.println(Thread.currentThread().getName() + "æ‹¿åˆ°äº†ç¬¬" + tickNumbers-- + "å¼ ç¥¨");
        }
    }

    public static void main(String[] args) {
        TestThread4 ticket = new TestThread4();

        new Thread(ticket, "å°æ˜").start();
        new Thread(ticket, "è€å¸ˆ").start();
        new Thread(ticket, "é»„ç‰›å…š").start();
    }
}
```

###### 2.2.2 é¾Ÿå…”èµ›è·‘

```java
//æ¨¡æ‹Ÿé¾Ÿå…”èµ›è·‘
public class Race implements Runnable {
    //èƒœåˆ©è€…
    private static String winner;

    @Override
    public void run() {
        for (int i = 0; i <= 1000; i++) {

            //æ¨¡æ‹Ÿå…”å­ä¼‘æ¯ ä¸”æ¯50æ­¥ä¼‘æ¯ä¸€æ¬¡
            if (Thread.currentThread().getName().equals("å…”å­") && i%50 == 0) {
                try {
                    Thread.sleep(10);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            //åˆ¤æ–­æ¯”èµ›æ˜¯å¦ç»“æŸ
            boolean flag = gameOver(i);
            if (flag) {
                break;
            }
            System.out.println(Thread.currentThread().getName() + "è·‘äº†" + i + "æ­¥");
        }
    }


    /**
     * åˆ¤æ–­æ¯”èµ›æ˜¯å¦ç»“æŸ
     * @param steps æ­¥æ•°
     * @return
     */
    private boolean gameOver(int steps) {
        if (winner != null) {
            //å·²ç»å­˜åœ¨èƒœåˆ©è€…äº†
            return true;
        }
        {   //è¿™æ˜¯ä¸€ä¸ªä»£ç å—
            if (steps >= 1000) {
                winner = Thread.currentThread().getName();
                System.out.println("winner is " + winner);
                return true;
            }
        }
        return false;
    }

    public static void main(String[] args) {
        Race race = new Race();//ä¸€æ¡èµ›é“

        new Thread(race, "å…”å­").start();
        new Thread(race, "ä¹Œé¾Ÿ").start();
    }
}
```

#### 1.3 å®ç°Callableæ¥å£(äº†è§£)

1. å®ç°Callableæ¥å£ï¼Œéœ€è¦è¿”å›å€¼ç±»å‹
   ```java 
   implements Callable<è¿”å›å€¼ç±»å‹> 
   ```

2. `é‡å†™callæ–¹æ³•ï¼Œéœ€è¦æŠ›å‡ºå¼‚å¸¸

   ```java
   @Override
   public è¿”å›å€¼ç±»å‹ call() {}
   ```

3. åˆ›å»ºç›®æ ‡å¯¹è±¡(Callableæ¥å£å®ç°ç±»)

   ```java
   ç›®æ ‡ç±» ç›®æ ‡å¯¹è±¡ = new ç›®æ ‡ç±»();
   ```

4. åˆ›å»ºæ‰§è¡ŒæœåŠ¡(çº¿ç¨‹æ± æœåŠ¡ä¸ºå›ºå®šå‡ ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ) Executor: çº¿ç¨‹æ±  fixedï¼šå›ºå®šçš„ Poolï¼šæ± 
   ```java
   ExecutorService ser = Executors.newFixedThreadPool(çº¿ç¨‹ä¸ªæ•°);
   ```

5. æäº¤æ‰§è¡Œ(è¿”å›ä¸€ä¸ªå°è£…è¿”å›å€¼çš„Futureç±»)
   ```java
   Future<è¿”å›å€¼ç±»å‹> result1 = ser.submit(ç›®æ ‡å¯¹è±¡);
   Future<è¿”å›å€¼ç±»å‹> result2 = ser.submit(ç›®æ ‡å¯¹è±¡);
   //...  è¿™é‡Œå¯ä»¥å†™çº¿ç¨‹ä¸ªæ•°ä¸ªæ‰§è¡Œ
   ```

6. è·å–ç»“æœ
   ```java
   è¿”å›å€¼ç±»å‹ r1 = result1.get();
   è¿”å›å€¼ç±»å‹ r2 = result1.get();
   //...
   ```

7. å…³é—­æœåŠ¡
   ```java
   ser.shutdownNow();
   ```

å¥½å¤„

>Callableçš„å¥½å¤„
>
>1. å¯ä»¥å®šä¹‰è¿”å›å€¼
>2. å¯ä»¥æŠ›å‡ºå¼‚å¸¸

##### 1.3.1 æ¼”ç¤º

```java
public class TestCallable implements Callable<Boolean> {//Booleanæ˜¯è¿”å›å€¼ç±»å‹
    @Override
    public Boolean call() {//è¿™é‡Œçš„call()æ–¹æ³•ç±»ä¼¼ä¸Šä¸¤ç§æ–¹å¼çš„run()æ–¹æ³•
        //calæ–¹æ³•çº¿ç¨‹ä½“
        for (int i = 0; i < 2000; i++) {
            System.out.println("æˆ‘åœ¨çœ‹ä»£ç --" + i);
        }
        return true;
    }
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        TestCallable t1 = new TestCallable();//åˆ›å»ºCallableæ¥å£å®ç°ç±»
        TestCallable t2 = new TestCallable();
        TestCallable t3 = new TestCallable();
        
        //åˆ›å»ºæ‰§è¡ŒæœåŠ¡(çº¿ç¨‹æ± æœåŠ¡ åˆ›å»ºå›ºå®šçº¿ç¨‹æ± ) Executor: çº¿ç¨‹æ±  fixedï¼šå›ºå®šçš„ Poolï¼šæ± 
        ExecutorService ser = Executors.newFixedThreadPool(3);//3æ˜¯å›ºå®šçº¿ç¨‹æ± çš„ä¸ªæ•°
        
        //æäº¤æ‰§è¡Œ (è¿”å›ä¸€ä¸ªå°è£…è¿”å›å€¼ç±»å‹çš„Futureç±»)
        Future<Boolean> r1 = ser.submit(t1);
        Future<Boolean> r2 = ser.submit(t2);
        Future<Boolean> r3 = ser.submit(t3);
        
        //è·å–ç»“æœ
        boolean rs1 = r1.get();
        boolean rs2 = r2.get();
        boolean rs3 = r3.get();

        System.out.println(rs1);
        System.out.println(rs2);
        System.out.println(rs3);
        //å…³é—­çº¿ç¨‹æ± æœåŠ¡
        ser.shutdownNow();
    }
}
```

##### 1.3.2 æ¡ˆä¾‹

###### 1.3.2.1 åˆ©ç”¨Callableæ”¹é€ ä¸‹è½½å›¾ç‰‡æ¡ˆä¾‹

[ç‚¹å‡»æŸ¥çœ‹åŸä¸‹è½½å›¾ç‰‡æ¡ˆä¾‹](#####1.1.2.1 Threadå®ç°å¤šçº¿ç¨‹åŒæ­¥ä¸‹è½½å›¾ç‰‡)

```java
public class TestCallable implements Callable<Boolean> {
    private String url;//ç½‘ç»œå›¾ç‰‡åœ°å€
    private String name;//ä¿å­˜çš„æ–‡ä»¶å

    public TestCallable(String url, String name) {
        this.url = url;
        this.name = name;
    }
    @Override
    public Boolean call() {
        WebDownloader webDownloader = new WebDownloader();
        webDownloader.downloader(url, name);
        System.out.println("ç°åœ¨çš„æ–‡ä»¶åä¸ºï¼š" + name);
        return true;
    }

    public static void main(String[] args) throws ExecutionException, InterruptedException {
        TestCallable t1 = new TestCallable("https://img-home.csdnimg.cn/images/20230213094345.jpg", "1.jpg");
        TestCallable t2 = new TestCallable("https://img-home.csdnimg.cn/images/20230213094345.jpg", "2.jpg");
        TestCallable t3 = new TestCallable("https://img-home.csdnimg.cn/images/20230213094345.jpg", "3.jpg");

        //åˆ›å»ºæ‰§è¡ŒæœåŠ¡ Executor: çº¿ç¨‹æ±  fixedï¼šå›ºå®šçš„ Poolï¼šæ± 
        ExecutorService ser = Executors.newFixedThreadPool(3);

        //æäº¤æ‰§è¡Œ
        Future<Boolean> r1 = ser.submit(t1);
        Future<Boolean> r2 = ser.submit(t2);
        Future<Boolean> r3 = ser.submit(t3);

        //è·å–ç»“æœ
        boolean rs1 = r1.get();
        boolean rs2 = r2.get();
        boolean rs3 = r3.get();

        System.out.println(rs1);
        System.out.println(rs2);
        System.out.println(rs3);
        //å…³é—­æœåŠ¡
        ser.shutdownNow();
    }
}

class WebDownloader {
    //ä¸‹è½½æ–¹æ³•
    public void downloader(String url, String name) {
        try {
            FileUtils.copyURLToFile(new URL(url), new File(name));//æŠŠä¸€ä¸ªç½‘ç»œurlå˜ä¸ºå›¾ç‰‡ä¸‹è½½ä¸ºname
        } catch (IOException e) {
            e.printStackTrace();
            System.out.println("IOå¼‚å¸¸,downloadæ–¹æ³•å‡ºç°é—®é¢˜");
        }
    }
```

### 2. çº¿ç¨‹çš„äº”å¤§çŠ¶æ€æµç¨‹åŠæ–¹æ³•

#### 2.1 äº”å¤§çŠ¶æ€æµç¨‹å›¾

```mermaid
graph TB
%% åˆ›å»ºçŠ¶æ€ï¼šnew Thread();
%% å¯åŠ¨çŠ¶æ€ï¼šthread.start();
%% è¿è¡ŒçŠ¶æ€ï¼šå¯åŠ¨ä¹‹åCPUè°ƒåº¦å®Œäº†
aa["new Thread"]-->a[åˆ›å»ºçŠ¶æ€]--"å¯åŠ¨çº¿ç¨‹(start)"-->b[å°±ç»ªçŠ¶æ€];
b--è·å¾—CPUèµ„æº-->c[è¿è¡ŒçŠ¶æ€]
c--"dead()"-->d[æ­»äº¡çŠ¶æ€]
c--"sleep()ã€wait()ã€åŒæ­¥é”å®šç­‰"-->e[é˜»å¡çŠ¶æ€]
c--"yield()çº¿ç¨‹ç¤¼è®©"-->b
e--é˜»å¡è§£é™¤-->b
```

#### 2.2 çº¿ç¨‹æ–¹æ³•

| æ–¹æ³•                           | è¯´æ˜                                                         |
| ------------------------------ | ------------------------------------------------------------ |
| setPriority(int newPriority)   | æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§                                             |
| static void sleep(long millis) | è®©å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ä¼‘çœ millisæ¯«ç§’                           |
| void join()                    | ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢                                               |
| static void yield()            | çº¿ç¨‹ç¤¼è®©ï¼Œä»è¿è¡ŒçŠ¶æ€è½¬ä¸ºå°±ç»ªçŠ¶æ€ï¼Œé‡æ–°å¼€å§‹cpuè°ƒåº¦ï¼Œä»è¿è¡ŒçŠ¶æ€è½¬ä¸ºå°±ç»ªçŠ¶æ€ |
| void interrupt()               | ä¸­æ–­çº¿ç¨‹(ä¸å»ºè®®ç”¨è¿™ç§æ–¹å¼)                                   |
| boolean isAlive()              | æµ‹è¯•çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€                                     |

#### 2.3ã€stopã€‘åœæ­¢

- è¿™é‡Œçš„stopæ˜¯è‡ªå·±å†™çš„ï¼Œéœ€è¦è‡ªå·±æ§åˆ¶

##### 2.3.1 è¯¦è§£

- ä¸æ¨èä½¿ç”¨JDKæä¾›çš„stop()ã€destriyæ–¹æ³•ã€å·²åºŸå¼ƒã€‘

- æ¨èçº¿ç¨‹è‡ªå·±åœä¸‹æ¥

  - å»ºè®®ä½¿ç”¨ä¸€ä¸ªæ ‡å¿—ä½è¿›è¡Œç»ˆæ­¢å˜é‡ï¼Œå½“flag=falseï¼Œåˆ™ç»ˆæ­¢çº¿ç¨‹
    
    ```java
    public class Thread1 implements Runnable{	
    	@Override
    	public void run() {
    	    //çº¿ç¨‹ä½“ä½¿ç”¨è¯¥æ ‡å¿—
    	    while (flag) {
    	        //...
    	    }
    	}
    	//åœ¨çº¿ç¨‹ä¸­å†™ä¸€ä¸ªstopæ–¹æ³•ï¼Œç”¨äºä¿®æ”¹æ ‡å¿—ä½
    	public void stop() {
    	    this.flag = false;
    	}
    }
    ```
    

##### 2.3.2 ä»£ç æ¼”ç¤º

```java
public class TestStop implements Runnable{

//    1.è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½
    private boolean flag = true;
    @Override
    public void run() {
        int i = 0;//çº¿ç¨‹æ‰§è¡Œçš„æ¬¡æ•°
        while (flag) {
            System.out.println("çº¿ç¨‹æ‰§è¡Œrun...Thread" + i++ + "æ¬¡");
        }
    }

//    2.è®¾ç½®ä¸€ä¸ªå…¬å¼€çš„æ–¹æ³•åœæ­¢çº¿ç¨‹ï¼Œè½¬æ¢æ ‡å¿—ä½
    public  void stop() {
        this.flag = false;
    }

    public static void main(String[] args) {
        TestStop testStop = new TestStop();
        new Thread(testStop).start();
        System.out.println("çº¿ç¨‹å¼€å§‹äº†");

        for (int i = 0; i < 2000; i++) {//i mainæ–¹æ³•æ‰§è¡Œçš„æ¬¡æ•°
            System.out.println("mainæ‰§è¡Œ" + i + "æ¬¡");
            if (i == 900) {
//                è°ƒç”¨stopæ–¹æ³•åˆ‡æ¢æ ‡å¿—ä½ï¼Œè®©çº¿ç¨‹åœæ­¢
                testStop.stop();
                System.out.println("çº¿ç¨‹åœæ­¢äº†");
            }
        }
    }
}
```

#### 2.4 sleepä¼‘çœ 

##### 2.4.1 è¯¦è§£

- sleep(æ¯«ç§’å€¼)ï¼šæŒ‡å®šå½“å‰çº¿ç¨‹é˜»å¡çš„æ¯«ç§’å€¼
- sleepå­˜åœ¨InterruptedException
- sleepæ—¶é—´è¾¾åˆ°åçº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€
- sleepå¯ä»¥æ¨¡æ‹Ÿç½‘ç»œå»¶æ—¶ï¼Œå€’è®¡æ—¶ç­‰
- æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªé”ğŸ”’ï¼Œsleepä¸ä¼šé‡Šæ”¾é”

##### 2.4.2 ä»£ç æ¼”ç¤º

```java
////æ‰“å°10æ¬¡å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œæ¯ç§’æ‰“å°ä¸€æ¬¡
public static void main(String[] args) {
        Date startTime = new Date(System.currentTimeMillis());//è·å–ç³»ç»Ÿå½“å‰æ—¶é—´
        int i = 0;
        while (i < 10) {
            try {
                Thread.sleep(1000);
                System.out.println(new SimpleDateFormat("HH:mm:ss").format(startTime));
                startTime = new Date(System.currentTimeMillis());
                i++;
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }
}
```

#### 2.5 yieldç¤¼è®©

- ç¤¼è®©å°±æ˜¯é‡æ–°å¼€å§‹cpuè°ƒåº¦ï¼Œä»è¿è¡ŒçŠ¶æ€è½¬ä¸ºå°±ç»ªçŠ¶æ€

##### 2.5.1 è¯¦è§£

- å°†çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€è½¬ä¸ºå°±ç»ªçŠ¶æ€ï¼Œä½†ä¸é˜»å¡ï¼Œä¸å…¶ä»–çº¿ç¨‹é‡æ–°ç«äº‰cpu
- è®©cpué‡æ–°è°ƒåº¦ï¼Œç¤¼è®©ä¸ä¸€å®šä¼šæ¯”å…¶ä»–çº¿ç¨‹æ…¢ï¼Œçœ‹cpuå¿ƒæƒ…

##### 2.5.2 ä»£ç æ¼”ç¤º

```java
public class TestYield {
    public static void main(String[] args) {
        MyYield myYield = new MyYield();

        new Thread(myYield, "a").start();
        new Thread(myYield, "b").start();
    }
}

class MyYield implements Runnable {
    @Override
    public void run() {
        System.out.println(Thread.currentThread().getName() + "çº¿ç¨‹å¼€å§‹æ‰§è¡Œ");
        //ç¤¼è®©åï¼Œç”²ä»è¿è¡ŒçŠ¶æ€è½¬ä¸ºæš‚åœ(å°±ç»ªçŠ¶æ€)ï¼Œä¹™æœ¬å°±æ˜¯å°±ç»ªçŠ¶æ€ï¼Œcpué‡æ–°è°ƒåº¦ï¼Œå¯èƒ½å‡ºç°ç”²ç»§ç»­è¿è¡Œ
        Thread.yield();
        System.out.println(Thread.currentThread().getName() + "çº¿ç¨‹åœæ­¢æ‰§è¡Œ");
    }
}
```

#### 2.6 joinæ’é˜Ÿ

##### 2.6.1 è¯¦è§£

- å¼ºåˆ¶æ‰§è¡Œä¸”å¾ˆéœ¸é“
- ç±»ä¼¼vipï¼Œæ²¡æœ‰æ’é˜Ÿ(æ²¡æœ‰vip)æ—¶å…¬å¹³æ‰§è¡Œï¼Œæ’é˜Ÿ(æœ‰vip)åå¼ºåˆ¶æ‰§è¡Œæ’é˜Ÿçº¿ç¨‹
- ç›´åˆ°æ’é˜Ÿ(vip)çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ‰å¯æ‰§è¡Œå…¶ä»–çº¿ç¨‹

##### 2.6.2 ä»£ç æ¼”ç¤º

```java
//æ’é˜Ÿ,ä¸”å¾ˆéœ¸é“
public class TestJoin implements Runnable{
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            System.out.println("çº¿ç¨‹vipæ¥å•¦" + i);
        }
    }

    public static void main(String[] args) throws InterruptedException {
        //å¯åŠ¨æˆ‘ä»¬çš„çº¿ç¨‹
        TestJoin testJoin = new TestJoin();
        Thread thread = new Thread(testJoin);
        thread.start();

        //ä¸»çº¿ç¨‹
        for (int i = 0; i < 1000; i++) {
            if (i == 200) {
                thread.join();//æ’mainçº¿ç¨‹çš„é˜Ÿï¼Œå½“mainçº¿ç¨‹æ‰§è¡Œåˆ°199æ—¶threadæ‰§è¡Œä¸”å¿…é¡»threadæ‰§è¡Œå®Œåmainæ‰èƒ½ç»§ç»­æ‰§è¡Œ
            }
            System.out.println("main" + i);
        }
    }
}
```

#### 2.7 è§‚æµ‹çº¿ç¨‹çŠ¶æ€

##### 2.7.1 è¯­æ³•

stateæ˜¯Threadä¸­ä¸€ä¸ªæšä¸¾ç±»å‹çš„å˜é‡

```java
Thread.State state = thread.getState();
```

##### 2.7.2 å«ä¹‰

| çŠ¶æ€          | ç®€è¿° | å«ä¹‰                                                   |
| ------------- | ---- | ------------------------------------------------------ |
| NEW           | æ–°ç”Ÿ | å°šæœªå¯åŠ¨çš„çº¿ç¨‹                                         |
| RUNNABLE      | è¿è¡Œ | Javaè™šæ‹Ÿæœºä¸­æ‰§è¡Œçš„çº¿ç¨‹                                 |
| BLOCKED       | é˜»å¡ | è¢«é˜»å¡ç­‰å¾…ç›‘è§†å™¨é”å®šçš„çº¿ç¨‹                             |
| WAITING       | é˜»å¡ | æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šåŠ¨ä½œçš„çº¿ç¨‹                   |
| TIMED WAITING | é˜»å¡ | æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŠ¨ä½œè¾¾åˆ°æŒ‡å®šæ—¶é—´çš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ |
| TERMINATED    | æ­»äº¡ | å·²é€€å‡ºçš„çº¿ç¨‹                                           |

### 3.  çº¿ç¨‹ä¼˜å…ˆçº§

#### 3.1 è¯¦æƒ…

çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”¨æ•°å­—è¡¨ç¤ºï¼ŒèŒƒå›´ä»0~10(æ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œcpuè¶Šå®¹æ˜“è°ƒåº¦)

```java
//Threadä¸­æºç çš„ä¸€äº›å¸¸é‡
public static final int MAX_PRIORITY = 10;
...
```

> Thread.MIN_PRIORITY = 1
> Thread.MAX_PRIORITY = 10
> Thread.NORE_PRIORITY = 5

ä½¿ç”¨`getPriority()`å’Œ`setPriority(int xxx)`æ¥è·å–å’Œæ”¹å˜ä¼˜å…ˆçº§

#### 3.2 ä»£ç æ¼”ç¤º

```java
//æ‰“å°ä¸åŒä¼˜å…ˆçº§çš„å„çº¿ç¨‹ï¼Œè§‚å¯Ÿæ‰§è¡Œé¡ºåº
public class TestPriority{
    public static void main(String[] args) {
        //mainä¸»çº¿ç¨‹æ˜¯é»˜è®¤ä¼˜å…ˆçº§5ï¼Œæ— æ³•æ”¹å˜
        System.out.println(Thread.currentThread().getName() + "-->" + Thread.currentThread().getPriority());

        MyPriority myPriority = new MyPriority();
        Thread t1 = new Thread(myPriority);
        Thread t2 = new Thread(myPriority);
        Thread t3 = new Thread(myPriority);
        Thread t4 = new Thread(myPriority);
        Thread t5 = new Thread(myPriority);
        Thread t6 = new Thread(myPriority);

        //è®¾ç½®ä¼˜å…ˆçº§ï¼ˆä¼˜å…ˆçº§å†1-10ä¹‹é—´ï¼‰
        t1.setPriority(Thread.MIN_PRIORITY);//1
        t2.setPriority(2);
        t3.setPriority(3);
        t4.setPriority(4);
        t5.setPriority(5);
        t6.setPriority(Thread.MAX_PRIORITY);//10

        //å¯åŠ¨
        t1.start();
        t2.start();
        t3.start();
        t4.start();
        t5.start();
        t6.start();
    }
}

class MyPriority implements Runnable {
    @Override
    public void run() {
        System.out.println(Thread.currentThread().getName() + "-->" + Thread.currentThread().getPriority());
    }
}
```

### 4. å®ˆæŠ¤çº¿ç¨‹(daemon)

#### 4.1 è¯¦è§£

- çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·ç°ç¨‹(é»˜è®¤å°±æ˜¯ç”¨æˆ·çº¿ç¨‹)å’Œå®ˆæŠ¤çº¿ç¨‹
  ```java
  //å°†threadçº¿ç¨‹è®¾ä¸ºå®ˆæŠ¤çº¿ç¨‹ Daemonï¼šå®ˆæŠ¤çº¿ç¨‹
  thread.setDaemon(true);//é»˜è®¤æ˜¯falseè¡¨ç¤ºæ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œä¸æ˜¯å®ˆæŠ¤çº¿ç¨‹
  ```
- è™šæ‹Ÿæœºå¿…é¡»ç¡®ä¿ã€Œç”¨æˆ·çº¿ç¨‹ã€æ‰§è¡Œå®Œæ¯•
- è™šæ‹Ÿæœºä¸ç”¨ç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯•
- å¦‚ï¼Œåå°è®°å½•æ“ä½œæ—¥å¿—ï¼Œç›‘æ§å†…å­˜ï¼Œåƒåœ¾å›æ”¶ç­‰å¾…

> æ³¨ï¼š
>
> 1. è™šæ‹Ÿæœºä¸ä¼šç®¡å®ˆæŠ¤çº¿ç¨‹ï¼Œå…¶ä»–çº¿ç¨‹è·‘å®Œåä¸ç®¡å®ˆæŠ¤çº¿ç¨‹æ˜¯å¦è·‘å®Œï¼Œè™šæ‹Ÿæœºéƒ½ä¼šå…³é—­
> 2. è™šæ‹Ÿæœºå…³é—­éœ€è¦æ—¶é—´ï¼Œå› æ­¤å®ˆæŠ¤çº¿ç¨‹åœ¨ç”¨æˆ·çº¿ç¨‹è·‘å®Œåä»ä¼šè¿è¡Œä¸€æ®µæ—¶é—´

#### 4.2 ä»£ç æ¼”ç¤º

```java
//ä¸Šå¸å®ˆæŠ¤ä½ ç›´åˆ°ä½ æ­»å»
public class TestDaemon {
    public static void main(String[] args) {
        God god = new God();
        You you = new You();

        Thread thread = new Thread(god);
        thread.setDaemon(true);//é»˜è®¤æ˜¯falseè¡¨ç¤ºæ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œtrueä¸ºå®ˆæŠ¤çº¿ç¨‹

        thread.start();//ä¸Šå¸ å®ˆæŠ¤çº¿ç¨‹  è™šæ‹Ÿæœºä¸ä¼šç®¡å®ˆæŠ¤çº¿ç¨‹ï¼Œå…¶ä»–çº¿ç¨‹è·‘å®Œåä¸ç®¡å®ˆæŠ¤çº¿ç¨‹æ˜¯å¦è·‘å®Œï¼Œè™šæ‹Ÿæœºä»ä¼šç»“æŸï¼Œè™šæ‹Ÿæœºå…³é—­éœ€è¦æ—¶é—´ï¼Œå› æ­¤å®ˆæŠ¤çº¿ç¨‹åœ¨ç”¨æˆ·çº¿ç¨‹è·‘å®Œåä»ä¼šè¿è¡Œä¸€æ®µæ—¶é—´

        new Thread(you).start();//ä½  ç”¨æˆ·çº¿ç¨‹å¯åŠ¨
    }
}

//ä¸Šå¸ ä¸Šå¸ä¸€ç›´åœ¨ä¿ä½‘ç€ä½ ï¼Œç›´åˆ°ä½ æ­»å»
class God implements Runnable {
    @Override
    public void run() {
        while (true) {
            System.out.println("ä¸Šå¸ä¿ä½‘ç€ä½ ");
        }
    }
}

//ä½  æ´»äº†16500å¤©
class You implements Runnable {
    @Override
    public void run() {
        for (int i = 0; i < 36500; i++) {
            System.out.println("ä»Šå¤©ä½ æˆåŠŸç”Ÿå­˜äº†" + i + "å¤©");
        }
        System.out.println("====goodbyeï¼world====");
    }
}
```

### 5.  çº¿ç¨‹åŒæ­¥ï¼ˆé˜Ÿåˆ—+é”ï¼‰

#### 5.1 å‘ç°é—®é¢˜ï¼š

- å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€å—å­˜åº“ç©ºé—´ï¼Œå¸¦æ¥æ–¹ä¾¿çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†ã€Œå¹¶å‘ã€é—®é¢˜

- å¹¶å‘ï¼šåŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ

- å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å¯¹è±¡ï¼Œä¸”æŸäº›çº¿ç¨‹è¿˜æƒ³ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°±éœ€è¦ã€Œçº¿ç¨‹åŒæ­¥ã€æ¥è§£å†³è¿™ä¸ªé—®é¢˜

  > æ¯”å¦‚é“¶è¡Œï¼š
  > åŒä¸€å¼ é“¶è¡Œå¡å­˜äº†300w RMB
  > ä½ å’Œä½ åª³å¦‡åŒæ—¶å–é’±å‡ºç°å¹¶å‘é—®é¢˜ï¼Œ
  > ä½ åœ¨æ‰‹æœºä¸Šå–100RMBï¼Œ
  > ä½ åª³å¦‡åœ¨é“¶è¡Œå–300w RMBï¼Œ
  > è¿™æ ·å°±ä¼šè·å¾—300.01w RMB,å‡ºç°é—®é¢˜ï¼Œ
  > é“¶è¡Œè¡€äº100RMB
  
- å½“å‘ç”Ÿå¹¶å‘æ—¶ï¼Œå¦‚ä¹°ç¥¨ï¼Œå¤šä¸ªäººåŒæ—¶ä¹°ï¼Œä»–ä»¬éƒ½å‘ç°å”®ç¥¨å¤„è¿˜æœ‰ä¸€å¼ ç¥¨ï¼Œå°±æŠŠä¸€å¼ ç¥¨æ‹·è´çš„è‡ªå·±çš„å†…å­˜åŒºåŸŸï¼Œç„¶åè¿›è¡Œè´­ä¹°ï¼Œç»“æœæ˜¯æ¯äººä¹°äº†ä¸€å¼ ç¥¨ï¼Œè´­ä¹°æ—¶å”®ç¥¨å¤„ç¥¨æ•°`--`ï¼Œå”®ç¥¨å¤„è¿˜æœ‰è´Ÿæ•°å¼ ç¥¨ï¼‰

#### 5.2 è§£å†³é—®é¢˜ã€Œé˜Ÿåˆ— + é”ã€

- çº¿ç¨‹åŒæ­¥å…¶å®å°±æ˜¯ä¸€ç§**ç­‰å¾…æœºåˆ¶**

- è§£å†³æ–¹å¼ï¼šã€Œé˜Ÿåˆ— + é”ã€

  - **ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§**

    > eg:ä¸Šå•æ‰€
    >
    > å¤šä¸ªç”¨æˆ·åŒæ—¶ä¸Šå•æ‰€ï¼Œéœ€è¦æ’é˜Ÿ
    > ä¸Šå•æ‰€çš„äººä¼šæŠŠå‘ä¸Šçš„é—¨åé”ä¿è¯å…¶ä½™äººä¸ä¼šè¿›å…¥
    >
    > å½“ä¸Šå®Œå•æ‰€åæ‰“å¼€é”
    > é˜Ÿåˆ—ä¸­ä¸‹ä¸€äººè¿›å…¥

    - å¤šä¸ªéœ€è¦åŒæ—¶è®¿é—®æ­¤å¯¹è±¡çš„çº¿ç¨‹è¿›å…¥è¿™ä¸ªå¯¹è±¡çš„ã€Œå¯¹è±¡ç­‰å¾…æ± ã€å½¢æˆ**é˜Ÿåˆ—**ï¼Œç­‰å¾…å‰é¢çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹å†ä½¿ç”¨

    - ä¸ºä¿è¯é˜Ÿåˆ—ï¼Œåœ¨è®¿é—®æ—¶åŠ å…¥äº†**é”æœºåˆ¶(synchronized)**ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å¾—å¯¹è±¡çš„æ’ä»–é”åï¼Œç‹¬å èµ„æºï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼Œä½¿ç”¨åé‡Šæ”¾é”å³å¯

    - æ¯ä¸ªçº¿ç¨‹**åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜äº¤äº’**ï¼Œå†…å­˜æ§åˆ¶ä¸å½“ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´

      > eg:ä¹°ç¥¨ï¼Œå¤šä¸ªäººåŒæ—¶ä¹°ï¼Œä»–ä»¬éƒ½å‘ç°å”®ç¥¨å¤„åªæœ‰ä¸€å¼ ç¥¨æ—¶ï¼Œå°±æŠŠå”®ç¥¨å¤„è¿˜æœ‰ä¸€å¼ ç¥¨æ‹·è´çš„è‡ªå·±çš„å†…å­˜åŒºåŸŸï¼Œç„¶åè¿›è¡Œè´­ä¹°ï¼Œç»“æœæ˜¯æ¯äººä¹°äº†ä¸€å¼ ç¥¨ï¼Œè´­ä¹°æ—¶å”®ç¥¨å¤„ç¥¨æ•°`--`ï¼Œç»“æœæ˜¯å”®ç¥¨å¤„è¿˜æœ‰è´Ÿæ•°å¼ ç¥¨ï¼‰

  - **é˜Ÿåˆ— + é”ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜**

    - ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ä¼šå¯¼è‡´å…¶ä»–æ‰€æœ‰éœ€è¦æ­¤é”çš„çº¿ç¨‹**æŒ‚èµ·**(æ€§èƒ½å˜æ…¢)
    - åœ¨å¤šçº¿ç¨‹ç«äº‰ä¸‹ï¼ŒåŠ é”ï¼Œé‡Šæ”¾é”ä¼šå¯¼è‡´æ¯”è¾ƒå¤šçš„ã€Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€å’Œã€Œè°ƒåº¦å»¶æ—¶ã€ï¼Œå¼•èµ·æ€§èƒ½é—®é¢˜(æ€§èƒ½å˜æ…¢)
    - å¦‚æœä¸€ä¸ªä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ç­‰å¾…ä¸€ä¸ªä¼˜å…ˆçº§ä½çš„çº¿ç¨‹é‡Šæ”¾é”ä¼šå¯¼è‡´**ä¼˜å…ˆçº§å€’ç½®**ï¼Œå¼•èµ·æ€§èƒ½é—®é¢˜

### 6 . synchronizedé”

synchronizedé”çš„ä¸¤ç§ç”¨æ³•ï¼š

1. synchronized()æ–¹æ³•
2. synchronizedå—

- synchronized()æ–¹æ³•åªèƒ½é”this
- æ–¹æ³•é‡Œé¢éœ€è¦ä¿®æ”¹çš„å†…å®¹æ‰éœ€è¦é”ï¼Œé”çš„å¤ªå¤šä¼šæµªè´¹èµ„æºï¼Œç”±æ­¤äº§ç”Ÿsynchronizedå—
- synchronized(Obj){}ä»£ç å—å¯ä»¥é”ä»»æ„å¯¹è±¡ï¼Œé”ä½çš„å¯¹è±¡å°±æ˜¯å˜åŒ–çš„å¯¹è±¡ï¼Œéœ€è¦å¢åˆ æ”¹çš„å¯¹è±¡

#### 6.1 synchronized()æ–¹æ³•

##### 6.1.1  è¯¦è§£

```java
 public synchronized void method(int args){}
```

- åŒæ­¥æ–¹æ³•çš„Objã€ŒåŒæ­¥ç›‘è§†å™¨ã€å°±æ˜¯this
- synchronizedæ–¹æ³•æ§åˆ¶å¯¹ã€Œå¯¹è±¡ã€çš„è®¿é—®ï¼Œæ¯ä¸ªå¯¹è±¡å¯¹åº”ä¸€æŠŠé”ï¼Œæ¯ä¸ªsynchronizedæ–¹æ³•å¿…é¡»è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡çš„é”æ‰èƒ½æ‰§è¡Œsynchronizedæ–¹æ³•ï¼Œå¦åˆ™çº¿ç¨‹ä¼šé˜»å¡
- æ–¹æ³•ä¸€æ—¦æ‰§è¡Œï¼Œå°±ç‹¬å è¯¥é”ï¼Œç›´åˆ°è¯¥æ–¹æ³•è¿”å›æ‰é‡Šæ”¾é”ï¼Œåé¢è¢«é˜»å¡çš„çº¿ç¨‹æ‰èƒ½è·å¾—è¿™ä¸ªé”ç»§ç»­æ‰§è¡Œ
- ç¼ºé™·ï¼šè‹¥å°†ä¸€ä¸ªå¤§çš„æ–¹æ³•ç”³æ˜ä¸ºsynchronizedå°†ä¼šå½±å“æ•ˆç‡ï¼ˆä¸é«˜æ•ˆï¼‰

##### 6.1.2 æ¡ˆä¾‹ä¹°ç¥¨

```Java
//ä¸å®‰å…¨çš„ä¹°ç¥¨(ä¼šå‡ºç°å¤šä¸ªçº¿ç¨‹åŒæ—¶å‘ç°è¿˜æœ‰1å¼ ç¥¨ï¼Œå¹¶å°†æœ‰ä¸€å¼ ç¥¨çš„ä¿¡æ¯æ‹·è´åˆ°è‡ªå·±å†…å­˜ç©ºé—´ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¹°è¿™ä¸€å¼ ç¥¨ï¼Œå”®ç¥¨å¤„ç¥¨æ•°å¤šæ¬¡--ï¼Œå‡ºç°è´Ÿæ•°)
//è§£å†³æ–¹å¼ï¼šsynchronizedæ–¹æ³•ï¼ˆé”çš„æ˜¯thisï¼‰
public class UnsafeBuyTicket {
    public static void main(String[] args) {
        BuyTicket station = new BuyTicket();

        new Thread(station,"è‹¦é€¼çš„æˆ‘").start();
        new Thread(station,"ç‰›é€¼çš„ä½ ä»¬").start();
        new Thread(station,"å¯æ¶çš„é»„ç‰›å…š").start();
    }
}

class BuyTicket implements Runnable {
    private int ticketNums = 10;
    boolean flag = true;//å¤–éƒ¨åœæ­¢æ–¹å¼

    @Override
    public void run() {
        //ä¹°ç¥¨
        while (flag) {
            try {
                buy();
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }
    }

    //ä¹°ç¥¨
    private void buy() throws InterruptedException {
        //åˆ¤æ–­æ˜¯å¦æœ‰ç¥¨
        if (ticketNums <= 0) {
            flag = false;
            return;
        }
        Thread.sleep(100);
        //ä¹°ç¥¨
        System.out.println(Thread.currentThread().getName() + "æ‹¿åˆ°" + ticketNums--);
    }
}
```

#### 6.2 synchronizedåŒæ­¥å—

##### 6.2.1 è¯¦è§£

```java 
synchronized(Obj){}
```

- äº§ç”Ÿï¼šæ–¹æ³•é‡Œé¢éœ€è¦ä¿®æ”¹çš„å†…å®¹æ‰éœ€è¦é”ï¼Œé”çš„å¤ªå¤šä¼šæµªè´¹èµ„æºï¼Œç”±æ­¤äº§ç”Ÿsynchronizedå—
- Obj å°±æ˜¯é”ä½çš„å¯¹è±¡ï¼Œç§°ä¹‹ä¸ºã€ŒåŒæ­¥ç›‘è§†å™¨ã€
  - Obj å¯ä»¥æ˜¯**ä»»ä½•å¯¹è±¡**ï¼Œä½†æ˜¯æ¨èä½¿ç”¨å…±äº«èµ„æºä½œä¸ºåŒæ­¥ç›‘è§†å™¨
  - é”ä½çš„å¯¹è±¡å°±æ˜¯å˜åŒ–çš„å¯¹è±¡ï¼Œéœ€è¦å¢åˆ æ”¹çš„å¯¹è±¡
  - åŒæ­¥æ–¹æ³•ä¸­æ— éœ€æŒ‡å®šåŒæ­¥ç›‘è§†å™¨ï¼Œå› ä¸ºåŒæ­¥æ–¹æ³•çš„åŒæ­¥ç›‘è§†å™¨å°±æ˜¯thisï¼Œå°±æ˜¯è¿™æ¢ä¸ªå¯¹è±¡æœ¬èº«ï¼Œæˆ–è€…æ˜¯ classã€åå°„ä¸­ã€‘
- Objã€ŒåŒæ­¥ç›‘è§†å™¨ã€çš„æ‰§è¡Œè¿‡ç¨‹
  1. ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé”å®šåŒæ­¥ç›‘è§†å™¨ï¼Œæ‰§è¡Œå…¶ä¸­ä»£ç 
  2. ç¬¬äºŒä¸ªçº¿ç¨‹è®¿é—®ï¼Œå‘ç°åŒæ­¥ç›‘è§†å™¨è¢«é”å®šï¼Œæ— æ³•è®¿é—®
  3. ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¿é—®å®Œæ¯•ï¼Œè§£é”åŒæ­¥ç›‘è§†å™¨
  4. ç¬¬äºŒä¸ªçº¿ç¨‹è®¿é—®ï¼Œå‘ç°åŒæ­¥ç›‘è§†å™¨æ²¡æœ‰é”ï¼Œç„¶åé”å®šå¹¶è®¿é—®



##### 6.2.2 æ¡ˆä¾‹

###### çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆ(åŒæ­¥ä»£ç å—)

```java
//çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆ(ä¸¤ä¸ªçº¿ç¨‹åœ¨åŒä¸€ç¬é—´å¯èƒ½ä¼šåœ¨åŒä¸€ä¸ªä½ç½®æ·»åŠ æ•°æ®ï¼Œæ•°æ®ä¼šè¢«è¦†ç›–æ‰ï¼Œä¹Ÿå°±æ˜¯æ·»åŠ çš„ä½ç½®ä¸å®‰å…¨)
//è§£å†³æ–¹å¼ï¼šsynchronizedåŒæ­¥å—ï¼ˆé”çš„æ˜¯å˜åŒ–çš„å¯¹è±¡ï¼‰
public class UnsafeList {
    public static void main(String[] args) throws InterruptedException {
        List<String> list = new ArrayList<>();
        for (int i = 0; i < 10000; i++) {
            new Thread(()-> {
                //synchronizedå—ï¼ˆé”çš„æ˜¯å˜åŒ–çš„å¯¹è±¡listï¼‰
                synchronized (list) {
                    list.add(Thread.currentThread().getName());//æ·»åŠ æ—¶ä¼šåœ¨æœ€åä¸€ä¸ªä½ç½®æ·»åŠ 
                }
            }).start();
        }
        Thread.sleep(3000);
        System.out.println(list.size());//æ‰“å°é›†åˆçš„å…ƒç´ ä¸ªæ•°ï¼Œå¯èƒ½å°‘äº10000
    }
}
```

#### 6.3 æ¡ˆä¾‹

1. [ä¹°ç¥¨(synchronizedæ–¹æ³•)](#####6.1.2 æ¡ˆä¾‹ä¹°ç¥¨)
2. [çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆ(synchronizedå—)](######çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆ(åŒæ­¥ä»£ç å—))
3. [çº¿ç¨‹å®‰å…¨çš„é›†åˆ()](#####çº¿ç¨‹å®‰å…¨çš„é›†åˆ(jdkä¸­å·²ç»å†™å¥½çš„))

##### çº¿ç¨‹å®‰å…¨çš„é›†åˆ(jdkä¸­å·²ç»å†™å¥½çš„)

concurrent: å¹¶å‘åŒ…

```java
import java.util.concurrent.CopyOnWriteArrayList;

//æµ‹è¯•JUCå®‰å…¨ç±»å‹çš„é›†åˆ
public class TestJUC {
    public static void main(String[] args) {
        CopyOnWriteArrayList<String> list = new CopyOnWriteArrayList<String>();//çº¿ç¨‹å®‰å…¨çš„list
        for (int i = 0; i < 10000; i++) {
            new Thread( () -> {
                list.add(Thread.currentThread().getName());
            }).start();
        }
        try {
            Thread.sleep(3000);
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
        System.out.println(list.size());//1000
    }
}

```

### 7.  æ­»é”

#### 7.1 è¯¦æƒ…

å¤šä¸ªçº¿ç¨‹å„è‡ªå æœ‰ä¸€äº›å…±äº«èµ„æºï¹å¹¶ä¸”äº’ç›¸ç­‰å¾…å…¶ä»–çº¿ç¨‹å æœ‰çš„èµ„æºæ‰èƒ½è¿è¡Œï¹è€Œå¯¼è‡´ä¸¤ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¹éƒ½åœæ­¢æ‰§è¡Œçš„æƒ…å½¢ï¼Œå°±æ˜¯æ­»é”

æœ‰ä¸€äº›å…±äº«èµ„æºï¼ŒæŸä¸€ä¸ªåŒæ­¥ä»£ç å—åŒæ—¶æ‹¥æœ‰å¤šä¸ªé”ã€Œä¸¤ä¸ªä»¥ä¸Šä¸åŒå¯¹è±¡çš„é”ã€å°±ä¼šå‡ºç°æ­»é”

#### 7.2 äº§ç”Ÿæ­»é”çš„å››ä¸ªæ¡ä»¶

- äº’æ–¥æ¡ä»¶:ä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚
- è¯·æ±‚ä¸ä¿æŒæ¡ä»¶:ä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚
- ä¸å‰¥å¤ºæ¡ä»¶:è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚
- å¾ªç¯ç­‰å¾…æ¡ä»¶:è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚

#### 7.3 æ¡ˆä¾‹

##### 7.3.1 è§£é‡Š

ä¸€ä¸ªäºº(çº¿ç¨‹)å…ˆæœ‰äº†é•œå­ï¼Œä»–åˆæƒ³è¦å£çº¢
ä¸€ä¸ªäºº(çº¿ç¨‹)å…ˆæœ‰äº†å£çº¢ï¼Œä»–åˆæƒ³è¦é•œå­
ä¸¤ä¸ªäºº(çº¿ç¨‹)éƒ½æ‹¥æœ‰å¯¹æ–¹æƒ³è¦çš„ä¸œè¥¿(é”)ï¼Œä½†ä¸¤ä¸ªå¯¹æ–¹æƒ³è¦çš„é”éƒ½è¢«å¯¹æ–¹å æœ‰
ä»–ä»¬éƒ½ç­‰å¾…å¯¹æ–¹åšå®Œè‡ªå·±çš„äº‹åæ”¾ä¸‹ä¸œè¥¿(é‡Šæ”¾é”)å†å»æ‹¿å¯¹æ–¹æ”¾ä¸‹çš„ä¸œè¥¿(æ‹¿åˆ°å¯¹æ–¹é‡Šæ”¾çš„é”)ï¼Œåå»å¹²è‡ªå·±çš„äº‹
è€Œç¨‹åºä¸ä¼šä¸»åŠ¨é‡Šæ”¾é”ï¼Œåªæœ‰åœ¨åŒæ­¥ä»£ç å—æ‰§è¡Œå®Œæ¯•æ‰ä¼šé‡Šæ”¾é”ï¼Œä½†ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦å¦ä¸€äºº(çº¿ç¨‹)å æœ‰çš„ä¸œè¥¿(é”)
æ‰€ä»¥äºº(çº¿ç¨‹)ä¼šä¸€ç›´ç­‰å¾…å¦ä¸€äºº(çº¿ç¨‹)å®Œæˆè‡ªå·±è¦åšçš„äº‹ï¼Œåå†å®Œæˆè‡ªå·±çš„äº‹ï¼Œå°±ä¼šä¸€ç›´ç›¸äº’ç­‰å¾…

##### 7.3.2 å›¾ç¤º

æœ‰ä¸€ä¸ªé•œå­å’Œä¸€ä¸ªå£çº¢ï¼š
```mermaid
graph LR
a1{"é•œå­(å¯¹è±¡)"}
b2{"å£çº¢(ç›®å‰åœ¨å°çº¢é‚£å„¿)"}
b1{"å£çº¢(å¯¹è±¡)"}
a2{"é•œå­(ç›®å‰åœ¨å°é’é‚£å„¿)"}

f["å°é’(çº¿ç¨‹a)"] --> g["å…ˆæ‹¿åˆ°(é”ä½)"] --> b1
b1 ..-> h["æƒ³æ‹¿åˆ°(æƒ³é”ä½)"]
h ..-> a2
a2..-> k[å®Œæˆè‡ªå·±æƒ³åšçš„äº‹]..-> l["æ”¾ä¸‹ä¸œè¥¿(é‡Šæ”¾èµ„æº)"]
l..->b1
l..->a2

c["å°çº¢(çº¿ç¨‹a)"] --> d["å…ˆæ‹¿åˆ°(é”ä½)"] --> a1
a1 ..-> e["æƒ³æ‹¿åˆ°(æƒ³é”ä½)"]
e ..-> b2
b2..-> i[å®Œæˆè‡ªå·±æƒ³åšçš„äº‹]..-> j["æ”¾ä¸‹ä¸œè¥¿(é‡Šæ”¾èµ„æº)"]
j ..-> a1
j..->b2
```

#### 7.4 æ¡ˆä¾‹ä»£ç æ¼”ç¤º

##### 7.4.1 å‰ç½®ä»£ç 

```java
public class DeadLock {
    public static void main(String[] args) {
        Makeup g1 = new Makeup(0, "å°é’");
        Makeup g2 = new Makeup(1, "å°çº¢");

        g1.start();
        g2.start();
    }
}
//å…±äº«èµ„æº å£çº¢å’Œé•œå­
//å£çº¢
class Lipstick {}
//é•œå­
class Mirror {}

//å»åŒ–å¦†
class Makeup extends Thread {
    //å£çº¢
    static Lipstick lipstick = new Lipstick();
    //é•œå­
    static Mirror mirror = new Mirror();

    int choice;//é€‰æ‹©
    String girlName;//ä½¿ç”¨åŒ–å¦†å“çš„äºº

    Makeup(int choice, String girlName) {
        this.choice = choice;
        this.girlName = girlName;
    }

    @Override
    public void run() {
        //åŒ–å¦†
        try {
            makeup();
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
    }

    //åŒ–å¦†ï¼Œäº’ç›¸æŒæœ‰å¯¹æ–¹çš„é”ï¼Œå°±æ˜¯éœ€è¦å¾—åˆ°å¯¹æ–¹çš„èµ„æº
    private void makeup() throws InterruptedException {
        //è§6.3.2åŠ6.3.1
    }
}
```

##### 7.4.2 å‡ºç°æ­»é”

ç”¨äº†åŒæ­¥ä»£ç å—åµŒå¥—

```java
private void makeup() throws InterruptedException {
    if (choice == 0) {
        //é”çš„åµŒå¥—å¯¼è‡´æ­»é”
        synchronized (lipstick) {//ä»–æ‹¿åˆ°äº†å£çº¢
            System.out.println(this.girlName + "æ‹¿åˆ°äº†å£çº¢");
            Thread.sleep(1000);
            
            synchronized (mirror) {//ä»–åˆæƒ³æ‹¿é•œå­
                System.out.println(this.girlName + "æ‹¿åˆ°äº†é•œå­");
            }
        } else {
            synchronized (mirror) {//ä»–æ‹¿åˆ°äº†é•œå­
                System.out.println(this.girlName + "æ‹¿åˆ°äº†é•œå­");
                Thread.sleep(2000);

                synchronized (lipstick) {//ä»–åˆæƒ³æ‹¿å£çº¢
                    System.out.println(this.girlName + "æ‹¿åˆ°äº†å£çº¢");
                }
            }
        }
    }
```

##### 7.4.3 è§£å†³æ­»é”é—®é¢˜

ä¸ç”¨åµŒå¥—é”ï¼Œç”¨å®Œä¸€ä¸ªé”ç«‹å³é‡Šæ”¾

```java
    private void makeup() throws InterruptedException {
        if (choice == 0) {
            //ä¸ç”¨åµŒå¥—ï¼Œç”¨å®Œä¼šç«‹å³é‡Šæ”¾
            synchronized (lipstick) {//ä»–æ‹¿åˆ°äº†å£çº¢
                System.out.println(this.girlName + "æ‹¿åˆ°äº†å£çº¢");
                Thread.sleep(1000);
            }
            synchronized (mirror) {//ä»–åˆæƒ³æ‹¿é•œå­
                System.out.println(this.girlName + "æ‹¿åˆ°äº†é•œå­");
            }
        } else {
            synchronized (mirror) {//ä»–æ‹¿åˆ°äº†é•œå­
                System.out.println(this.girlName + "æ‹¿åˆ°äº†é•œå­");
                Thread.sleep(2000);
            }
            synchronized (lipstick) {//ä»–åˆæƒ³æ‹¿å£çº¢
                System.out.println(this.girlName + "æ‹¿åˆ°äº†å£çº¢");
            }
        }
    }
```

### 8. Locké”

#### 8.1 è¯¦è§£

- ä»JDK 5.0å¼€å§‹ï¼ŒJavaæä¾›äº†æ›´å¼ºå¤§çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶â€”â€”é€šè¿‡**æ˜¾å¼å®šä¹‰åŒæ­¥é”å¯¹è±¡**æ¥å®ç°åŒæ­¥ã€‚åŒæ­¥é”ä½¿ç”¨Lockå¯¹è±¡å……å½“
- java.util.concurrent.locks.Lockæ¥å£æ˜¯æ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¿›è¡Œè®¿é—®çš„å·¥å…·ã€‚
- é”æä¾›äº†å¯¹å…±äº«èµ„æºçš„ç‹¬å è®¿é—®ï¼Œæ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹Lockå¯¹è±¡åŠ é”ï¼Œçº¿ç¨‹å¼€å§‹è®¿é—®å…±äº«èµ„æºä¹‹å‰åº”å…ˆè·å¾—Lockå¯¹è±¡
- ReentrantLock ç±»å®ç°äº†Lockï¼Œå®ƒæ‹¥æœ‰ä¸synchronizedç›¸åŒçš„å¹¶å‘æ€§å’Œå†…å­˜è¯­ä¹‰ï¼Œåœ¨å®ç°çº¿ç¨‹å®‰å…¨çš„æ§åˆ¶ä¸­ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ReentrantLockï¼Œå¯ä»¥æ˜¾å¼åŠ é”ã€é‡Šæ”¾é”ã€‚
  `private final ReentrantLock lock = new ReentrantLock();`

#### 8.2 è¯­æ³•

```java
class A im{
    //å®šä¹‰Locké” ReentrantLock:å¯é‡è¿›å…¥é”
    private final ReentrantLock lock = new ReentrantLock();

    public void m() {
        lock.lock();//åŠ é”
        
        try {
            //ä¿è¯çº¿ç¨‹å®‰å…¨çš„ä»£ç ;
        } finally {
            //è§£é”
            lock.unlock();
            //å¦‚æœåŒæ­¥ä»£ç æœ‰å¼‚å¸¸ï¼Œè¦å°†unlock()å†™å…¥finallyè¯­å¥å—ï¼Œä¸€èˆ¬å°†å…¶å†™å…¥å°±å¥½
        }
    }
}   
```

#### 8.3 synchronized ä¸ Lock é”çš„å¯¹æ¯”

- Lockæ˜¯æ˜¾å¼é”ï¼ˆæ‰‹åŠ¨å¼€å¯å’Œå…³é—­é”ï¼Œåˆ«å¿˜è®°å…³é—­é”) synchronizedæ˜¯éšå¼é”ï¼Œå‡ºäº†ä½œç”¨åŸŸè‡ªåŠ¨é‡Šæ”¾
- Lockåªæœ‰ä»£ç å—é”ï¼Œsynchronizedæœ‰ä»£ç å—é”å’Œæ–¹æ³•é”
- ä½¿ç”¨Locké”ï¼ŒJVMå°†èŠ±è´¹è¾ƒå°‘çš„æ—¶é—´æ¥è°ƒåº¦çº¿ç¨‹ï¼Œæ€§èƒ½æ›´å¥½ã€‚å¹¶ä¸”å…·æœ‰æ›´å¥½çš„æ‰©å±•æ€§(æä¾›æ›´å¤šçš„å­ç±»)
- ä¼˜å…ˆä½¿ç”¨é¡ºåº:
  Lock >åŒæ­¥ä»£ç å—ï¼ˆå·²ç»è¿›å…¥äº†æ–¹æ³•ä½“ï¼Œåˆ†é…äº†ç›¸åº”èµ„æº)>åŒæ­¥æ–¹æ³•ï¼ˆåœ¨æ–¹æ³•ä½“ä¹‹å¤–)

#### 8.4 æ¡ˆä¾‹

ä¹°ç¥¨

```java
package com.kuang.thread;

import java.util.concurrent.locks.ReentrantLock;

//æµ‹è¯•Locké” å¯ä»¥æ˜¾å¼çš„å®šä¹‰é”
public class TestLock {
    public static void main(String[] args) {
        TestLock2 testLock2 = new TestLock2();

        new Thread(testLock2).start();
        new Thread(testLock2).start();
        new Thread(testLock2).start();
    }
}

class TestLock2 implements Runnable {
    int ticketNums = 10;

    //å®šä¹‰Locké” ReentrantLock:å¯é‡è¿›å…¥é”
    private final ReentrantLock lock = new ReentrantLock();

    @Override
    public void run() {
        while (true) {
            try {
                lock.lock();//åŠ é”
                if (ticketNums > 0) {
                    try {
                        Thread.sleep(1000);
                    } catch (InterruptedException e) {
                        throw new RuntimeException(e);
                    }
                    System.out.println(ticketNums--);
                } else {
                    break;
                }
            } finally {
                //è§£é”
                lock.unlock();
            }
        }
    }
}
```

### 9.  çº¿ç¨‹åä½œ

#### 9.1 ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼

è¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å…±äº«åŒä¸€ä¸ªèµ„æºï¼Œå¹¶ä¸”ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ç›¸äº’ä¾èµ–ï¼Œäº’ä¸ºæ¡ä»¶ï¼

- å¯¹äºç”Ÿäº§è€…ï¼Œæ²¡æœ‰ç”Ÿäº§äº§å“ä¹‹å‰ï¼Œè¦é€šçŸ¥æ¶ˆè´¹è€…ç­‰å¾…`wait()`ï¹’è€Œç”Ÿäº§äº†äº§å“ä¹‹åï¼Œåˆéœ€è¦é©¬ä¸Šé€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹`notify()`
- å¯¹äºæ¶ˆè´¹è€…ï¹åœ¨æ¶ˆè´¹ä¹‹åï¼Œè¦é€šçŸ¥ç”Ÿäº§è€…å·²ç»ç»“æŸæ¶ˆè´¹ï¹éœ€è¦ç”Ÿäº§æ–°çš„äº§å“ä»¥ä¾›æ¶ˆè´¹.
- åœ¨ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ä¸­,ä»…æœ‰synchronizedæ˜¯ä¸å¤Ÿçš„
  - synchronizedå¯é˜»æ­¢å¹¶å‘æ›´æ–°åŒä¸€ä¸ªå…±äº«èµ„æºï¼Œå®ç°äº†åŒæ­¥
  - synchronizedä¸èƒ½ç”¨æ¥å®ç°ä¸åŒçº¿ç¨‹ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’(é€šä¿¡)

#### 9.2 çº¿ç¨‹é€šä¿¡çš„æ–¹æ³•

Javaæä¾›äº†å‡ ä¸ªæ–¹æ³•è§£å†³çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡é—®é¢˜

- å‡æ˜¯Objectç±»çš„æ–¹æ³•ï¼Œéƒ½åªèƒ½åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥ä»£ç å—ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸`IIIegalMonitorStateException`

| æ–¹æ³•å             | ä½œç”¨                                                         |
| ------------------ | ------------------------------------------------------------ |
| wait               | è¡¨ç¤ºçº¿ç¨‹ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹é€šçŸ¥ï¼Œä¸sleepä¸åŒï¼Œsleepä¸ä¼šé‡Šæ”¾é”ï¼Œwaitä¼šé‡Šæ”¾é” |
| wait(long timeout) | æŒ‡å®šç­‰å¾…çš„æ¯«ç§’æ•°                                             |
| notify()           | å”¤é†’ä¸€ä¸ªå¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹                                   |
| notifyAll()        | å”¤é†’åŒä¸€ä¸ªå¯¹è±¡ä¸Šæ‰€æœ‰è°ƒç”¨wait()æ–¹æ³•çš„çº¿ç¨‹,ä¼˜å…ˆçº§åˆ«é«˜çš„çº¿ç¨‹ä¼˜å…ˆè°ƒåº¦ |

### 10. å¹¶å‘åä½œæ¨¡å‹"ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼"

#### 10.1 ç®¡ç¨‹æ³•(å®¹å™¨)

##### 10.1.1 ä»‹ç»

- ç”Ÿäº§è€…:è´Ÿè´£**ç”Ÿäº§**æ•°æ®çš„æ¨¡å—(å¯èƒ½æ˜¯æ–¹æ³•ï¹å¯¹è±¡,çº¿ç¨‹ï¹è¿›ç¨‹);
- æ¶ˆè´¹è€…ï¸°è´Ÿè´£**å¤„ç†**æ•°æ®çš„æ¨¡å—(å¯èƒ½æ˜¯æ–¹æ³•ï¹å¯¹è±¡,çº¿ç¨‹,è¿›ç¨‹);
- ç¼“å†²åŒºâˆ¶æ¶ˆè´¹è€…ä¸èƒ½ç›´æ¥ä½¿ç”¨ç”Ÿäº§è€…çš„æ•°æ®ï¹ä»–ä»¬ä¹‹é—´æœ‰ä¸ªâ€œç¼“å†²åŒº

**ç”Ÿäº§è€…å°†ç”Ÿäº§å¥½çš„æ•°æ®æ”¾å…¥ç¼“å†²åŒº,æ¶ˆè´¹è€…ä»ç¼“å†²åŒºæ‹¿å‡ºæ•°æ®**

```mermaid
graph LR
a["Producer<br/>(ç”Ÿäº§è€…)"] --> b(æ•°æ®ç¼“å†²åŒº) --> c["Consumer</br>(æ¶ˆè´¹è€…)"]
```

##### 10.1.2 æ¡ˆä¾‹

```java
package com.kuang.thread;

//æµ‹è¯•ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹
//åˆ©ç”¨ç¼“å†²åŒºè§£å†³ï¼šç®¡ç¨‹æ³•
public class TestPC {
    public static void main(String[] args) {
        SynContainer container = new SynContainer();//newä¸€ä¸ªç¼“å†²åŒº(å®¹å™¨)

        new Producer(container).start();//ç”Ÿäº§è€…
        new Consumer(container).start();//æ¶ˆè´¹è€…
    }
}

//ç”Ÿäº§è€…
class Producer extends Thread {
    SynContainer container;//ä¸€ä¸ªç¼“å†²åŒº

    public Producer(SynContainer container) {
        this.container = container;
    }

    //ç”Ÿäº§
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            System.out.println("ç”Ÿäº§äº†" + i + "å·é¸¡");
            container.push(new Chicken(i));
        }
    }
}

//æ¶ˆè´¹è€…
class Consumer extends Thread {
    SynContainer container;//ä¸€ä¸ªç¼“å†²åŒº

    public Consumer(SynContainer container) {
        this.container = container;
    }

    //æ¶ˆè´¹
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            System.out.println("æ¶ˆè´¹äº†" + container.pop().id + "å·é¸¡");
        }
    }
}

//äº§å“
class Chicken {
    int id;//äº§å“ç¼–å·

    public Chicken(int id) {
        this.id = id;
    }
}

//ç¼“å†²åŒº
class SynContainer {
    //éœ€è¦ä¸€ä¸ªå®¹å™¨å¤§å°
    Chicken[] chickens = new Chicken[10];
    //å®¹å™¨è®¡æ•°å™¨
    int count = 0;

    //ç”Ÿäº§è€…æ”¾å…¥äº§å“
    public synchronized void push(Chicken chicken) {
        //å¦‚æœå®¹å™¨æ»¡äº†ï¼Œå°±éœ€è¦ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹
        if (count == chickens.length) {
            //é€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œç”Ÿäº§ç­‰å¾…
            try {
                this.wait();
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }
        //å¦‚æœæ²¡æœ‰æ»¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸¢å…¥äº§å“
        chickens[count] = chicken;
        count++;

        //æˆ‘ä»¬å¯ä»¥é€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹äº†
        this.notify();
    }

    //æ¶ˆè´¹è€…æ¶ˆè´¹äº§å“
    public synchronized Chicken pop(){
        //åˆ¤æ–­èƒ½å¦æ¶ˆè´¹
        if (count == 0) {
            //ç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§ï¼Œæ¶ˆè´¹è€…ç­‰å¾…
            try {
                this.wait();
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }

        //å¦‚æœå¯ä»¥æ¶ˆè´¹
        count--;
        Chicken chicken = chickens[count];

        //æ‹¿åˆ°äº†ï¼Œé€šçŸ¥ç”Ÿäº§è€…ç”Ÿäº§
        this.notify();
        return chicken;
    }
}
```



#### 10.2 ä¿¡å·ç¯æ³•(æ ‡å¿—ä½)

##### 10.2.1 ä»‹ç»

è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½ï¼Œå½“flag==trueä»–å°±ç­‰å¾…this.wait()ï¼Œå¦‚æœflag==falseå°±å»é€šçŸ¥å¦ä¸€ä¸ªäººthis.notifyAll()

```java 
class Test {
    public static void main(String[] args) {
        B b = new B();//å•†å“
        new A1(b).start();//ç”Ÿäº§è€…A1çº¿ç¨‹ç”Ÿäº§bå¯åŠ¨
        new A2(b).start();//æ¶ˆè´¹è€…A2çº¿ç¨‹æ¶ˆè´¹bå¯åŠ¨
    }
}
//ç”Ÿäº§è€…A1
class A1 extends Thread {
    B b;

    public A1(B b) {
        this.b = b;
    }

    @Override
    public void run() {
        //ç”Ÿäº§ä¸­...
    }
}
//æ¶ˆè´¹è€…A2
class A2 extends Thread {
    B b;
    public A2(B b) {
        this.b = b;
    }

    @Override
    public void run() {
        //æ¶ˆè´¹ä¸­...
    }
}

//äº§å“B
class B {
    boolean flag = true;//Tä¸ºéœ€è¦ç”Ÿäº§

    //ç”Ÿäº§
    public synchronized void BA1(String newSection) {
        if (flag != true) {//è¿˜æœ‰å•†å“ï¼Œä¸éœ€è¦ç”Ÿäº§
            try {
                this.wait();
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }
        //ç”Ÿäº§
        //...
        
        //é€šçŸ¥æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹äº†
        this.notifyAll();
        this.flag = !this.flag;
    }
    
      //æ¶ˆè´¹
    public synchronized void BA2(String newSection) {
        if (flag != true) {//æ²¡æœ‰æ–°å•†å“ï¼Œæ— æ³•æ¶ˆè´¹ç­‰å¾…ç”Ÿäº§è€…ä¸Šæ¶
            try {
                this.wait();
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }
        //æ¶ˆè´¹
        //...
        
        //é€šçŸ¥ç”Ÿäº§è€…ç”Ÿäº§
        this.notifyAll();
        this.flag = !this.flag;
    }

}
```

##### 10.2.2 æ¡ˆä¾‹

çƒ­å¿ƒä½œè€…æ›´æ–°å‘å¸ƒç« èŠ‚ï¼Œé€šçŸ¥è¯»è€…ï¼Œç­‰å¾…è¯»è€…å‚¬æ›´ï¼Œå‚¬æ›´ç«‹å³æ›´æ–°å‘å¸ƒ
ç‹‚çƒ­è¯»è€…é˜…è¯»ï¼Œè¯»è€…å‚¬æ›´ï¼Œç­‰å¾…ä½œè€…æ›´æ–°ï¼Œæ›´æ–°ç«‹å³é˜…è¯»

```java
//ä¿¡å·ç¯æ³•ï¼šæ ‡å¿—ä½è§£å†³
public class TestPC2 {
    public static void main(String[] args) {
        Book book = new Book();
        new Writer(book).start();
        new Reader(book).start();
    }
}

//ç”Ÿäº§è€…--ã€‹ä½œè€…
class Writer extends Thread {
    Book book;

    public Writer(Book book) {
        this.book = book;
    }

    @Override
    public void run() {
        for (int i = 1; i < 30; i++) {
            this.book.play("ç¬¬" + i + "ç« ");
        }
    }
}

//æ¶ˆè´¹è€…--ã€‹è¯»è€…
class Reader extends Thread {
    Book book;

    public Reader(Book book) {
        this.book = book;
    }

    @Override
    public void run() {
        for (int i = 0; i < 29; i++) {
            this.book.read();
        }
    }
}

//äº§å“--ã€‹ä¹¦çš„ç« èŠ‚
class Book {
    //ä½œè€…å†™ç¨¿ï¼Œè§‚ä¼—æœŸå¾…(ç­‰å¾…)T
    //è§‚ä¼—é˜…è¯»ï¼Œä½œè€…ä¼‘æ¯(ç­‰å¾…)F
    String newSection;//æ–°ç« èŠ‚
    boolean flag = true;//T:è¡¨ç¤ºæœ‰æ–°ç« èŠ‚ï¼Œè¯»è€…å¯ä»¥å»è¯»äº†

    //èµ¶ç¨¿ ç”Ÿäº§ä¹¦çš„ç« èŠ‚
    public synchronized void play(String newSection) {
        if (flag != true) {
            try {
                this.wait();
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }
        System.out.println("ä½œè€…æ›´æ–°ç« èŠ‚äº†-->" + newSection);
        //é€šçŸ¥è§‚ä¼—å¯ä»¥é˜…è¯»äº†
        this.notifyAll();//å”¤é†’
        this.newSection = newSection;
        this.flag = !this.flag;
    }

    //è§‚çœ‹ æ¶ˆè´¹ä¹¦çš„ç« èŠ‚
    public synchronized void read() {
        if (flag) {
            try {
                this.wait();
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }
        System.out.println("è¯»è€…è¯»å®Œæ–°ç« èŠ‚-->" + newSection);
        //å‚¬æ›´ï¼Œé€šçŸ¥ä½œè€…åŠ æ›´
        this.notifyAll();
        this.flag = !this.flag;
    }
}
```

#### 10.3 çº¿ç¨‹æ± 

##### 10.3.1 è¯¦è§£

1. èƒŒæ™¯
   ç»å¸¸åˆ›å»ºå’Œé”€æ¯ã€ä½¿ç”¨é‡ç‰¹åˆ«å¤§çš„èµ„æºï¼Œæ¯”å¦‚å¹¶å‘æƒ…å†µä¸‹çš„çº¿ç¨‹ï¼Œå¯¹æ€§èƒ½å½±å“å¾ˆå¤§ã€‚

2. æ€è·¯
   æå‰åˆ›å»ºå¥½å¤šä¸ªçº¿ç¨‹ï¼Œæ”¾å…¥çº¿ç¨‹æ± ä¸­ï¼Œä½¿ç”¨æ—¶ç›´æ¥è·å–ï¼Œä½¿ç”¨å®Œæ”¾å›æ± ä¸­ã€‚å¯ä»¥é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯ã€å®ç°é‡å¤åˆ©ç”¨ã€‚ç±»ä¼¼ç”Ÿæ´»ä¸­çš„å…¬å…±äº¤é€šå·¥å…·ã€‚

3. å¥½å¤„

   - æé«˜å“åº”é€Ÿåº¦ï¼ˆå‡å°‘äº†åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶é—´)

   - é™ä½èµ„æºæ¶ˆè€—ï¼ˆé‡å¤åˆ©ç”¨çº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½åˆ›å»º)

   - ä¾¿äºçº¿ç¨‹ç®¡ç†(â€¦..)
     | å˜é‡            | å«ä¹‰                                 |
     | --------------- | ------------------------------------ |
     | corePoolSize    | æ ¸å¿ƒæ± çš„å¤§å°                         |
     | maximumPoolSize | æœ€å¤§çº¿ç¨‹æ•°                           |
     | keepAliveTime   | çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ—¶æœ€å¤šä¿æŒå¤šé•¿æ—¶é—´ä¼šç»ˆæ­¢ |

4. çº¿ç¨‹æ± ç›¸å…³API: ExecutorService å’Œ Executors

   1. ExecutorService:çœŸæ­£çš„çº¿ç¨‹æ± æ¥å£ã€‚å¸¸è§å­ç±»ThreadPoolExecutor

      - `void execute(Runnable command)`:æ‰§è¡Œä»»åŠ¡/å‘½ä»¤ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œä¸€èˆ¬ç”¨æ¥æ‰§è¡ŒRunnable
      - `<T> Future<T> submit(Callable<T> task)`:æ‰§è¡Œä»»åŠ¡ï¼Œæœ‰è¿”å›å€¼ï¼Œä¸€èˆ¬ç”¨æ¥æ‰§è¡ŒCallable
      - `void shutdown():`å…³é—­è¿æ¥æ± 

   2. Executors:å·¥å…·ç±»ã€çº¿ç¨‹æ± çš„å·¥å‚ç±»ï¼Œç”¨äºåˆ›å»ºå¹¶è¿”å›ä¸åŒç±»å‹çš„çº¿ç¨‹æ± 
      ```java
      ExecutorService service = Executors.newFixedThreadPool(10);
      ```

      

##### 10.3.2 ä»£ç æ¼”ç¤º

```java
public class TestPool {
    public static void main(String[] args) {
        //1. åˆ›å»ºçº¿ç¨‹æ±  å‚æ•°ä¸ºçº¿ç¨‹æ± å¤§å°
        ExecutorService service = Executors.newFixedThreadPool(10);

        //æ‰§è¡Œ
        service.execute(new MyThread());
        service.execute(new MyThread());
        service.execute(new MyThread());
        service.execute(new MyThread());

        //2. å…³é—­è¿æ¥
        service.shutdown();

    }
}

class MyThread implements Runnable {
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            System.out.println(Thread.currentThread().getName() + i);
        }
    }
}
```



## äºŒ. Lambdaè¡¨è¾¾å¼

### 1.ç®€ä»‹åŠè¯­æ³•

lambdaè¡¨è¾¾å¼æ˜¯å‡½æ•°å¼ç¼–ç¨‹

**å‰æ**

> å¿…é¡»æ˜¯å‡½æ•°å¼æ¥å£

ç†è§£å‡½æ•°å¼æ¥å£Functional interface(å‡½æ•°å¼æ¥å£) æ˜¯å­¦ä¹ Java8 lambdaçš„å…³é”®æ‰€åœ¨

**è¯­æ³•**

- ä»»ä½•æ¥å£ï¼Œå¦‚æœåªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ª**å‡½æ•°å¼æ¥å£**
  ```java
  public interface Runnable {
      public abstract void run();
  }
  ```

- å¯¹äºå‡½æ•°å¼æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡**lambdaè¡¨è¾¾å¼**æ¥åˆ›å»ºè¯¥æ¥å£çš„å¯¹è±¡
  ```java
  //å½“æŠ½è±¡æ–¹æ³•éœ€è¦ä¼ å‚æ—¶,()å†…å¯ä»¥ä¼ å‚æ•°
  //å¦‚ISum i = (int a) -> {};
  Runnable r1 = () -> {
      System.out.println("åœ¨æ­¤å†™Runnableæ¥å£å†…çš„å”¯ä¸€æŠ½è±¡æ–¹æ³•run()çš„æ–¹æ³•ä½“");
  }//ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªç±»å®ç°äº†Runnableæ¥å£
  ```

- ç®€åŒ–

  1. å¯ä»¥å»æ‰å‚æ•°ç±»å‹(å¤šä¸ªå‚æ•°æ—¶ä¹Ÿå¯çœç•¥)
  2. å¯ä»¥å»æ‰æ‹¬å·(å¤šä¸ªå‚æ•°æ—¶ä¸å¯çœç•¥æ‹¬å·)
  3. å¯ä»¥å»æ‰èŠ±æ‹¬å·(ä»…é™åªæœ‰ä¸€è¡Œæ–¹æ³•ä½“ï¼Œå¦‚æœæœ‰å¤šè¡Œä»éœ€èŠ±æ‹¬å·åŒ…è£¹)

### 2.Lambdaè¡¨è¾¾å¼çš„è¯ç”Ÿ

```mermaid
graph LR
a([1.å¤–éƒ¨ç±»])-.å®ç°.->b[[æ¥å£]]
c([2.é™æ€å†…éƒ¨ç±»])-.å®ç°.->b
d([3.å±€éƒ¨å†…éƒ¨ç±»])-.å®ç°.->b
e([4.åŒ¿åå†…éƒ¨ç±»])-.å€ŸåŠ©.->b
f([5.Lambdaè¡¨è¾¾å¼])-.åˆ©ç”¨.->b
a--ç®€åŒ–-->c
c--ç®€åŒ–-->d
d--ç®€åŒ–-->e
e--ç®€åŒ–-->f
```

### 3. ä»£ç æ¼”ç¤º

#### 3.1 Lambdaçš„æ¼”å˜

```java
/*
æ¨å¯¼Lambdaè¡¨è¾¾å¼
æ³¨é‡Š2->5é€æ¸ç®€åŒ–
 */
public class TestLambda1 {
    //3.é™æ€å†…éƒ¨ç±»
    static class Like2 implements ILike {
        @Override
        public void lambda() {
            System.out.println("I like Lambda2");
        }
    }

    public static void main(String[] args) {
        ILike like = new Like();//å®ç°ç±»
        like.lambda();

        like = new Like2();//é™æ€å†…éƒ¨ç±»
        like.lambda();

        //4.å±€éƒ¨å†…éƒ¨ç±»
        class Like3 implements ILike {
            @Override
            public void lambda() {
                System.out.println("I like Lambda3");
            }
        }
        like = new Like3();
        like.lambda();

        //5.åŒ¿åå†…éƒ¨ç±»,æ²¡æœ‰ç±»åç§°ï¼Œå¿…é¡»å€ŸåŠ©æ¥å£æˆ–è€…çˆ¶ç±»
        like = new ILike() {
            @Override
            public void lambda() {
                System.out.println("I like Lambda4");
            }
        };
        like.lambda();

        //6.ç”¨Lambdaç®€åŒ–
        like = () -> {
            System.out.println("I like Lambda5");
        };
        like.lambda();
    }
}
//1. å®šä¹‰ä¸€ä¸ªå‡½æ•°å¼æ¥å£
interface ILike {
    void lambda();
}
//2.å®ç°ç±»
class Like implements ILike {

    @Override
    public void lambda() {
        System.out.println("I like Lambda1");
    }
}
```

#### 3.2 ç®€åŒ–Lambdaè¡¨è¾¾å¼

```java
public class TestLambda2 {
    public static void main(String[] args) {
        ILove love = null;

        //4.0 lambda
        love = (String a)->{
            System.out.println("I love you-->" + a);
        };
        love.love("å°é’1");

        //4.1 ç®€åŒ–1ï¼šå»æ‰å‚æ•°ç±»å‹(å¤šä¸ªå‚æ•°æ—¶ä¹Ÿå¯çœç•¥)
        love = (a)->{
            System.out.println("I love you-->" + a);
        };
        love.love("å°é’2");

        //4.2 ç®€åŒ–2ï¼šå»æ‰æ‹¬å·(å¤šä¸ªå‚æ•°æ—¶ä¸å¯çœç•¥æ‹¬å·)
        love = a->{
            System.out.println("I love you-->" + a);
        };
        love.love("å°é’3");

        //4.3ï¼šå»æ‰èŠ±æ‹¬å·(ä»…é™åªæœ‰ä¸€è¡Œæ–¹æ³•ä½“ï¼Œå¦‚æœæœ‰å¤šè¡Œä»éœ€èŠ±æ‹¬å·åŒ…è£¹)
        love = a-> System.out.println("I love you-->" + a);
        love.love("å°é’4");

    }
}
interface ILove {
    void love(String a);
}
```

## ä¸‰. é™æ€ä»£ç†æ¨¡å¼

### 3.1 ä»‹ç»

**é™æ€ä»£ç†æ¨¡å¼ï¼š**
    çœŸå®å¯¹è±¡(ä¸ªäºº)å’Œä»£ç†å¯¹è±¡(å©šä»‹å…¬å¸)éƒ½è¦å®ç°åŒä¸€ä¸ªæ¥å£(å¹²ä¸€ä»¶äº‹)
    ä»£ç†å¯¹è±¡ä»£ç†çœŸå®è§’è‰²(åˆ›å»ºä»£ç†å¯¹è±¡æ—¶è¦ä¼ å…¥ç›®æ ‡å¯¹è±¡)
**å¥½å¤„ï¼š**
    ä»£ç†å¯¹è±¡å¯ä»¥åšå¾ˆå¤šçœŸå®å¯¹è±¡åšä¸äº†çš„äº‹(å¸ƒç½®ç°åœº)
    çœŸå®å¯¹è±¡ä¸“æ³¨äºè‡ªå·±çš„äº‹æƒ…(ç»“å©š)

**Threadæ˜¯ä»£ç†æ¨¡å¼**
		`new Thread(() -> System.out.println("æˆ‘çˆ±ä½ ")).start();`
		Threadç›¸å½“äºä»£ç†å¯¹è±¡
		()ç›¸å½“äºçœŸå®å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯Runnableå®ç°ç±»ï¼Œé‡å†™runæ–¹æ³•è°ƒç”¨run

### 3.2 ä»£ç æ¼”ç¤º

```java
public class StaticProxy {
    public static void main(String[] args) {
        You you = new You();//ä½ è¦ç»“å©š(çœŸå®å¯¹è±¡)

        WeddingCompany weddingCompany = new WeddingCompany(you);//å©šä»‹å…¬å¸å¸®åŠ©ä½ ç»“å©š(ä»£ç†å¯¹è±¡ä¼ å…¥çœŸå®å¯¹è±¡)
        weddingCompany.HappyMarry();//ä¸¤å¯¹è±¡å…±åŒå®Œæˆç»“å©š

        new WeddingCompany(new You()).HappyMarry();
    }
}

//ç»“å©š
interface Marry {
    //å¼€å¿ƒçš„ç»“å©š
    void HappyMarry();
}

//çœŸå®è§’è‰²ï¼Œä½  å»ç»“å©š çœŸå®å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦å®ç°åŒä¸€ä¸ªæ¥å£
//è¦å»ç»“å©šçš„ä½ ç±»
class You implements Marry {
    @Override
    public void HappyMarry() {
        System.out.println("ä½ ï¼šç»“å©šä¸­ï¼Œæ•²å¼€æ£®ï¼ï¼");
    }
}

//ä»£ç†è§’è‰²ï¼Œ å¸®åŠ©ä½ ç»“å©š çœŸå®å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦å®ç°åŒä¸€ä¸ªæ¥å£
//å©šä»‹å…¬å¸ç±»
class WeddingCompany implements Marry {
    private Marry target;
	
    //ä»£ç†å¯¹è±¡è¦æœ‰å‚æ•°ä¸ºçœŸå®å¯¹è±¡çš„æ„é€ æ–¹æ³•
    public WeddingCompany(Marry target) {
        this.target = target;
    }

    //å…¬å¸ä¸šåŠ¡
    @Override
    public void HappyMarry() {
        //ç»“å©šå‰
        before();
        //ä½ ç»“å©š
        this.target.HappyMarry();
        //ç»“å©šå
        after();
    }

    private void before() {
        System.out.println("å©šä»‹å…¬å¸ï¼šç»“å©šä¹‹å‰ï¼Œå¸ƒç½®ç°åœº");
    }
    private void after() {
        System.out.println("å©šä»‹å…¬å¸ï¼šç»“å©šä¹‹åï¼Œæ”¶å°¾æ¬¾");
    }

}
```

